(this["webpackJsonpmusic-mining"]=this["webpackJsonpmusic-mining"]||[]).push([[0],{107:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var r,c=n(34);function a(){return r||(r=Object(c.g)())}e.NODE_ENV}).call(this,n(22))},20:function(e,t){var n={APP_NAME:"JukeSoup",BASE_URI:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CLIENT_ID:"7acd727f06d34ecfb1c6d8b76c97d36d",REACT_APP_FIREBASE_API_KEY:"AIzaSyDQfAAJqtKOKXEdRL1SfqS3Pj8VjAIqvzE",REACT_APP_FIREBASE_AUTH_DOMAIN:"music-mining.firebaseapp.com",REACT_APP_FIREBASE_PROJECT_ID:"music-mining",REACT_APP_STORAGE_BUCKET:"music-mining.appspot.com",REACT_APP_MESSAGING_SENDER_ID:"616247216727",REACT_APP_FIREBASE_APP_ID:"1:616247216727:web:13e1f76d2cc06a0ab3f112"}).REACT_APP_BASE_URI||"http://localhost:3000",SPOTIFY_API:"https://api.spotify.com/v1",SPOTIFY_ACCOUNTS_API:"https://accounts.spotify.com",SPOTIFY_CLIENT_ID:"7acd727f06d34ecfb1c6d8b76c97d36d",SPOTIFY_SCOPES:["user-read-playback-state","user-modify-playback-state","user-read-currently-playing","user-read-recently-played"],MONEY_SINGULAR:"ticket",MONEY_PLURAL:"tickets",MAX_MONEY:20};n.SPOTIFY_REDIRECT_URI="".concat(n.BASE_URI,"/callback"),e.exports=n},226:function(e,t,n){},227:function(e,t,n){},236:function(e,t){},238:function(e,t){},248:function(e,t){},250:function(e,t){},277:function(e,t){},278:function(e,t){},283:function(e,t){},285:function(e,t){},292:function(e,t){},311:function(e,t){},344:function(e,t,n){},346:function(e,t,n){},350:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n(43),a=n(50),o=(n(226),n(19)),i=(n(227),n(103)),s=n(215),u=n(8),l=n(5),d=n(23),j=n(3),p=n.n(j),h=n(7),b=n(4),f=n(6),O=n(34),x=n(106),g=n.n(x),y=n(107),m=function(){if(localStorage.getItem("ORMDEBUG")){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["[ORM:DEBUG]"].concat(n,[{stack:new Error}]))}};m.group=function(e){return!1},m.groupEnd=function(){return!1};var v=function(){function e(){Object(b.a)(this,e)}return Object(f.a)(e,null,[{key:"setDb",value:function(t){m("Setting db connection to",t),e._dbconnection=t}},{key:"model",value:function(t,n){if(!n)return e._models[t];var r=new _(t,n,e._dbconnection);return e._models[t]=r,r}}]),e}();v._models={},v._dbconnection=y.a;var _=function(){function e(t,n,r){Object(b.a)(this,e),this._schema=n,this._collection=t,this._getdb=r,this._hooks={preCreate:function(){}}}return Object(f.a)(e,[{key:"preCreate",value:function(e){this._hooks.preCreate=e}},{key:"validate",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=Object(u.a)(n[t],2),c=r[0],a=r[1];if("_id"!==c){if(console.log(c,this._schema[c]),!this._schema[c])throw Error("document has extra property '".concat(c,"'\n        Schema keys are ").concat(Object.keys(this._schema).join(", ")));if(Array.isArray(this._schema[c])){if(!Array.isArray(a))throw Error("Expected ".concat(c," to be an Array but was ").concat(typeof a))}else if(typeof this._schema[c]()!==typeof a)throw Error("Expected '".concat(c,"' to be type ").concat(typeof this._schema[c](),", but was ").concat(typeof a,"\n        Schema keys are ").concat(Object.keys(this._schema).join(", ")))}}return e}},{key:"create",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,n,r,c,a,o,i=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=i.length>1&&void 0!==i[1]?i[1]:{},r=n.fetchDoc,c=void 0===r||r,m("creating document ",t),this._hooks.preCreate(t),this.validate(t),a=this._getdb(),e.next=8,Object(O.a)(Object(O.b)(a,this._collection),t);case 8:if(o=e.sent,!c){e.next=12;break}return m("fetching document"),e.abrupt("return",this.findById(o.id,{cache:!1}));case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,r,c,a,o,i,s,u,l,j,h=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.length>1&&void 0!==h[1]?h[1]:{},c=r.document,a=void 0===c||c,m.group("find"),m("called with query",t),t._id&&(o=t._id,delete t._id),i=this._getdb(),m("using db",i),s=Object(O.b)(i,this._collection),m("using collection",s),u=O.h.apply(void 0,[s].concat(Object(d.a)(k(t)))),e.next=11,Object(O.f)(u);case 11:if(l=e.sent,null===(n=l.docs)||void 0===n?void 0:n.length){e.next=16;break}return m("find: no query found"),m.groupEnd(),e.abrupt("return",void 0);case 16:if(!o){e.next=21;break}return j=g()(l.docs,(function(e){return e.id===o})),m("found doc (by id): ",j),m.groupEnd(),e.abrupt("return",a?[S(j)]:[j]);case 21:return m("found docs (as snapshots):",l.docs),m.groupEnd(),e.abrupt("return",a?l.docs.map(S):l.docs);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findOne",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,r,c,a,o=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=n.document,c=void 0===r||r,m.group("findOne"),e.next=4,this.find(t,{document:c});case 4:if(a=e.sent){e.next=9;break}return m("no docs found"),m.groupEnd(),e.abrupt("return");case 9:return m("fond ".concat(a.length," docs, first one is "),a[0]),m.groupEnd(),e.abrupt("return",a[0]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findById",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,r,c,a,o,i,s,u,l=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:{},r=n.cache,c=void 0===r||r,a=n.document,o=void 0===a||a,m.group("findById"),m("using id ",t,{cache:c},this._collection),i=this._getdb(),s=Object(O.c)(i,"/".concat(this._collection,"/").concat(t)),e.next=7,c?Object(O.d)(s):Object(O.e)(s);case 7:if(u=e.sent,m.groupEnd(),o){e.next=12;break}return m("returning snapshot rather than document"),e.abrupt("return",o);case 12:return e.abrupt("return",S(u));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findOrCreate",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var n,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.group("findOrCreate"),m("called with queryObj =",t),e.next=4,this.findOne(t);case 4:if(n=e.sent){e.next=13;break}return t._id||delete t._id,m("doc not found, creating."),e.next=10,this.create(t);case 10:return r=e.sent,m.groupEnd(),e.abrupt("return",r);case 13:return m("Found doc:",n),m.groupEnd(),e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(h.a)(p.a.mark((function e(t,n){var r,c,a,o,i,s,l,d,j,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.group("update"),e.next=3,this.findOne(t);case 3:if(r=e.sent){e.next=8;break}return m("Could not find doc!"),m.groupEnd(),e.abrupt("return",null);case 8:c=this._getdb(),a=Object(O.c)(c,"/".concat(this._collection,"/").concat(r._id)),m.groupEnd(),o=[],i=0,s=Object.entries(n);case 13:if(!(i<s.length)){e.next=22;break}return l=Object(u.a)(s[i],2),d=l[0],j=l[1],e.next=17,Object(O.i)(a,d,j);case 17:h=e.sent,o.push(h);case 19:i++,e.next=13;break;case 22:return e.abrupt("return",o);case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function k(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var c=Object(u.a)(r[n],2),a=c[0],o=c[1];t.push(Object(O.j)(a,"==",o))}return t}function S(e){if(null===e||void 0===e?void 0:e.data())return Object(l.a)(Object(l.a)({},e.data()),{},{_id:e.id})}var w=n(20),A={money:Number,score:Number,displayName:String},E=v.model("User",A);E.preCreate((function(e){var t;e.score=e.score||0,e.money=null!==(t=e.money)&&void 0!==t?t:w.MAX_MONEY}));var T=E;function I(){var e=Object(r.useState)(null),t=Object(u.a)(e,2),n=t[0],c=t[1];return Object(r.useEffect)((function(){var e=localStorage.getItem("_id");T.findOrCreate({_id:e}).then((function(t){localStorage.setItem("_id",t._id),c(e)}))})),n}var P=n(2);function C(){var e=Object(r.useState)(""),t=Object(u.a)(e,2),n=t[0],c=t[1];return setTimeout((function(){return c(Object(P.jsx)("div",{children:"Loading"}))}),1200),Object(P.jsx)(P.Fragment,{children:n})}function R(e){var t=e.children,n={width:"100vw",maxWidth:"520px",midWidth:"200px",padding:"14px"};return e.align&&(n.textAlign=e.align),Object(P.jsx)("div",{className:"mobilish",style:n,children:t})}var N=n(367),q=n(216),D=n(356);var F=function(e){var t=Object(o.t)();return null===I()?Object(P.jsx)(C,{}):Object(P.jsxs)(R,{children:[Object(P.jsx)("br",{}),Object(P.jsx)("br",{}),Object(P.jsxs)("h1",{children:[Object(P.jsx)(s.a,{})," Find a Soup"]}),Object(P.jsx)("hr",{}),Object(P.jsx)("br",{}),Object(P.jsxs)(N.a,{children:[Object(P.jsx)(N.a.Text,{children:"2-word phrase:"}),Object(P.jsx)(q.a,{placeholder:'(e.g. "shining pearl")'}),Object(P.jsx)(D.a,{variant:"outline-primary",children:"Find"})]}),Object(P.jsx)("br",{}),Object(P.jsxs)("div",{style:{display:"flex",alignContent:"center",flexDirection:"column"},children:[Object(P.jsx)("div",{style:{color:"#888",textAlign:"center",padding:"16px"},children:"or"}),Object(P.jsx)(D.a,{style:{width:"100%"},variant:"success",onClick:function(){return t("/soup/new")},children:"Create one"})]})]})},U=n(357),B=n(358),L=n(217),Y=n(364),M=n(90),K=["shining","cool","fun","rad","good","nice","helpful","hip","musical","kind","free","great","bad","hot","cold","warm","frozen","tall","short","quick","red","green","blue","square","smart","long","rich","calm","windy","round","solid","liquid","meta","cyber","swanky","fruity"],z=["pearl","mom","dad","daddy","boy","girl","car","trick","mine","quarry","pot","egg","seltzer","gas","power","iphone","salt","pepper","bed","table","soda","chair","rug","bean","ice","yoyo","rug","can","wheel","yoga","button","stick","fire","rain","sun","god","gold","cup","app","bread","box","toy","tea"];function W(){return[K[Math.floor(Math.random()*K.length)],z[Math.floor(Math.random()*z.length)]]}var H={leader:String,name:String,queue:[],phrase:String,created:Object,currentTrack:Object,startedAt:Object,isPlaying:Boolean,duration:Number},V=v.model("Quarry",H);V.preCreate((function(e){e.queue=[],e.created=new Date}));var G=V;function J(e){var t=Object(o.t)(),n=I(),c=Object(r.useState)(W()),a=Object(u.a)(c,2),i=a[0],s=a[1],l=Object(r.useState)(!1),d=Object(u.a)(l,2),j=d[0],p=d[1],h=Object(r.useState)(""),b=Object(u.a)(h,2),f=b[0],O=b[1],x=Object(r.useState)(!1),g=Object(u.a)(x,2),y=g[0],m=g[1],v=function(e){if(!1===e.currentTarget.checkValidity())return e.preventDefault(),void e.stopPropagation();p(!0),f&&(m(!0),G.create({leader:n,phrase:i.join("-"),name:f}).then((function(e){console.log("new quarry",e),t("/soup/".concat(e._id))})))};return null===n?Object(P.jsx)(C,{}):Object(P.jsx)(R,{children:Object(P.jsxs)(U.a,{fluid:!0,children:[Object(P.jsxs)(B.a,{md:"auto",className:"justify-content-center",children:[Object(P.jsx)(L.a,{sm:!0,style:{padding:"0 4px 0 0"},children:Object(P.jsx)("h1",{children:"Start a soup,"})}),Object(P.jsx)(L.a,{sm:!0,style:{padding:"0"},children:Object(P.jsx)("h1",{children:"discover music."})})]}),Object(P.jsx)(B.a,{children:Object(P.jsx)("hr",{})}),Object(P.jsx)(B.a,{children:Object(P.jsxs)(Y.a,{noValidate:!0,validated:j,onSubmit:v,action:"",children:[Object(P.jsxs)(Y.a.Group,{controlId:"name",children:[Object(P.jsx)(Y.a.Label,{children:"Soup Name"}),Object(P.jsx)(Y.a.Control,{required:!0,type:"input",placeholder:"(e.g. Nick's Soup)",value:f,onChange:function(e){O(e.target.value)}})]}),Object(P.jsx)("br",{}),Object(P.jsx)("div",{className:"d-md-none",style:{textAlign:"center"},children:"Your phrase:"}),Object(P.jsxs)(N.a,{style:{maxWidth:"480px"},children:[Object(P.jsx)(N.a.Text,{className:"d-none d-md-inline",children:"Your phrase:"}),Object(P.jsx)(q.a,{style:{textAlign:"center",fontFamily:"monospace",color:"red"},readOnly:!0,value:i[0],"aria-label":"First word of phrase"}),Object(P.jsx)(q.a,{style:{textAlign:"center",fontFamily:"monospace",color:"red"},readOnly:!0,value:i[1],"aria-label":"Second word of phrase"}),Object(P.jsx)(D.a,{className:"d-none d-md-inline",variant:"outline-secondary",onClick:function(){return s(W())},children:Object(P.jsx)(M.b,{})})]}),Object(P.jsx)(D.a,{className:"d-md-none",style:{width:"100%"},variant:"outline-secondary",onClick:function(){return s(W())},children:Object(P.jsx)(M.b,{})}),Object(P.jsx)(Y.a.Text,{className:"text-muted",children:"This is helps friends find you."}),Object(P.jsx)("br",{}),Object(P.jsx)("br",{}),Object(P.jsxs)(D.a,{className:y?"btn-secondary":"btn-success",style:{width:"100%"},type:"",onClick:v,disabled:y,children:[" ",y?"working \ud83d\udca6":"Create"]})]})})]})})}var Q=n(218),X=n.n(Q),$=n(127),Z=n.n($),ee="spotifyAccessToken_DO_NOT_SHARE",te="spotifyRefreshToken",ne=new(function(){function e(){Object(b.a)(this,e)}return Object(f.a)(e,[{key:"accessToken",get:function(){return localStorage.getItem(ee)},set:function(e){localStorage.setItem(ee,e)}},{key:"refreshToken",get:function(){return localStorage.getItem(te)},set:function(e){localStorage.setItem(te,e)}}]),e}()),re=new(function(){function e(){Object(b.a)(this,e),this.axios=this._createAxiosWithSpotifyAuth()}return Object(f.a)(e,[{key:"_createAxiosWithSpotifyAuth",value:function(){return Z.a.create({baseURL:w.SPOTIFY_API,headers:{Authorization:"Bearer ".concat(ne.accessToken)}})}},{key:"setAccessToken",value:function(e){ne.accessToken=e,this.axios=this._createAxiosWithSpotifyAuth()}},{key:"setRefreshToken",value:function(e){ne.refreshToken=e,this.axios=this._createAxiosWithSpotifyAuth()}},{key:"setTokensWithCode",value:function(){var e=Object(h.a)(p.a.mark((function e(t,n){var r,c,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new URLSearchParams).append("grant_type","authorization_code"),r.append("code",t),r.append("redirect_uri",w.SPOTIFY_REDIRECT_URI),r.append("client_id",w.SPOTIFY_CLIENT_ID),r.append("code_verifier",n),c="".concat(w.SPOTIFY_ACCOUNTS_API,"/api/token"),e.next=9,Z()({url:c,method:"post",data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 9:return a=e.sent,this.setAccessToken(a.data.access_token),this.setRefreshToken(a.data.refresh_token),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,n,r=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.axios.apply(this,r);case 3:t=e.sent,e.next=13;break;case 6:if(e.prev=6,e.t0=e.catch(0),"The access token expired"!==(null===(n=e.t0.response)||void 0===n?void 0:n.data.error.message)){e.next=13;break}return console.log("access token expired, trying new token"),e.next=12,this.requestAccessTokenFromRefreshToken();case 12:return e.abrupt("return",this.request.apply(this,r));case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"requestAccessTokenFromRefreshToken",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("starting refresh flow"),t=new URLSearchParams({grant_type:"refresh_token",refresh_token:ne.refreshToken,client_id:w.SPOTIFY_CLIENT_ID}),e.prev=2,e.next=5,Z()({url:"".concat(w.SPOTIFY_ACCOUNTS_API,"/api/token"),method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:t});case 5:return n=e.sent,ne.accessToken=n.data.access_token,ne.refreshToken=n.data.refresh_token,e.abrupt("return",n);case 11:if(e.prev=11,e.t0=e.catch(2),"Request failed with status code 400"!==e.t0.message&&!/The access token expired/.test(e.t0.message)){e.next=18;break}alert("Please reconnect Spotify"),window.location.href="/spotifyConnect",e.next=21;break;case 18:throw console.error("HANDLE THIS IN spotify.js"),console.log(e.t0),e.t0;case 21:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}()}]),e}()),ce="codeVerifier_DO_NOT_SHARE",ae=X()(48),oe=ae.code_verifier,ie=ae.code_challenge,se=new URLSearchParams;se.append("client_id",w.SPOTIFY_CLIENT_ID),se.append("response_type","code"),se.append("scope",w.SPOTIFY_SCOPES.join(" ")),se.append("redirect_uri",w.SPOTIFY_REDIRECT_URI),se.append("code_challenge_method","S256"),se.append("code_challenge",ie),console.log("using challenge ",ie);var ue="".concat(w.SPOTIFY_ACCOUNTS_API,"/authorize?").concat(se.toString());function le(){var e=Object(o.r)(),t=Object(o.t)(),n=new URLSearchParams(e.search),r=n.get("code"),c=n.get("error");if(c)return"access_denied"===c?Object(P.jsx)("h1",{children:"Oh."}):Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)("h1",{children:"Yikes."}),Object(P.jsx)("h6",{children:"Just walk away"})]});if(r){var a=localStorage.getItem(ce);return re.setTokensWithCode(r,a).then((function(e){return console.log(e),re.axios("/me/player/currently-playing")})).then((function(){return t("/soup/new")})).catch((function(e){return console.error(e.message)})),Object(P.jsx)(C,{})}return localStorage.setItem(ce,oe),Object(P.jsxs)(R,{align:"center",children:[Object(P.jsx)("h1",{children:"Connect Your Spotify Account"}),Object(P.jsxs)("p",{children:["Let ",w.APP_NAME," control your music player on Spotify. Connect an account you plan on playing loud and proud."]}),Object(P.jsx)("br",{}),Object(P.jsx)(D.a,{variant:"outline-dark",href:ue,children:"Authorize with Spotify"}),Object(P.jsx)("br",{}),Object(P.jsx)("br",{}),Object(P.jsx)("br",{}),Object(P.jsx)("small",{children:"We don't modify any data, such as playlists or liked songs (or anything else)"})]})}var de=n(50).useParams;function je(){var e=de().phrase,t=Object(o.t)();/^\w{1,10}-\w{1,10}$/.test(e)||t("/");var n=Object(r.useState)(null),c=Object(u.a)(n,2),a=c[0],i=c[1];return console.log("its ",e),G.find({phrase:e}).then((function(e){1===(null===e||void 0===e?void 0:e.length)?t("/soup/".concat(e[0]._id)):(null===e||void 0===e?void 0:e.length)>1?(console.log("todo"),i(e)):t("/")})),null===a?Object(P.jsx)(C,{}):Object(P.jsx)("div",{children:"This is a list of soups (TODO)"})}var pe=n(91),he=n(80),be=Object(r.createContext)({track:null,isPlaying:!1,startFrom:0,updateSpotify:!0}),fe=n(219),Oe=n.n(fe),xe="lastMoneyUpdate",ge=18e4,ye=null;function me(){null!==ye?(clearTimeout(ye),ye=null):console.warn("stopMoneyLoop - nothing to stop")}var ve=n(366),_e=n(359);function ke(e){var t=e.track;return t?Object(P.jsxs)("div",{className:"d-flex",children:[Object(P.jsx)("div",{style:{margin:"16px"},children:Object(P.jsx)("img",{src:t.album.images[2].url,alt:"Track album"})}),Object(P.jsxs)("div",{style:{margin:"16px"},children:[Object(P.jsxs)("div",{className:"fw-bold",children:[t.name," ",t.explicit&&Object(P.jsx)(_e.a,{bg:"secondary",children:"Explicit"}),"\xa0"]}),Object(P.jsx)("div",{children:t.artists.map((function(e){return e.name})).join(", ")})]})]}):null}n(344);function Se(e){var t=e.votes,n=e.track,r=e.onVote;return Object(P.jsxs)("div",{className:"container",children:[Object(P.jsxs)("div",{className:"voteWindow",children:[Object(P.jsx)("div",{className:"clickable",onClick:function(){return r("up",{track:n})},children:Object(P.jsx)(pe.c,{})}),Object(P.jsx)("div",{children:Object(P.jsx)("h3",{children:t})}),Object(P.jsx)("div",{className:"clickable",onClick:function(){return r("down",{track:n})},children:Object(P.jsx)(pe.a,{})})]}),Object(P.jsx)("div",{children:Object(P.jsx)(ke,{track:n})})]})}function we(e){var t=e.songs,n=e.onVote;if(!t)throw Error("SongQueue component must have props `songs`");var r=function(){return n.apply(void 0,arguments)};return t.length?Object(P.jsx)(P.Fragment,{children:Object(P.jsx)(ve.a,{children:Object(P.jsx)(ve.a.Text,{children:t.map((function(e){return Object(P.jsx)(Se,{votes:e.votes,track:e.track,onVote:r})}))})})}):Object(P.jsx)(P.Fragment,{children:Object(P.jsx)(ve.a,{children:Object(P.jsxs)(ve.a.Title,{children:[Object(P.jsx)(M.a,{})," No songs added yet"]})})})}var Ae=n(361),Ee=n(360),Te=n(363),Ie=n(369),Pe=n(365);function Ce(e){var t=e.phrase;return Object(P.jsx)(Pe.a,{defaultActiveKey:"0",children:Object(P.jsxs)(Pe.a.Item,{eventKey:"0",children:[Object(P.jsx)(Pe.a.Header,{children:"Bring your friends here \ud83d\ude4b\u200d\u2640\ufe0f"}),Object(P.jsxs)(Pe.a.Body,{children:["Tell them to enter ",Object(P.jsxs)("code",{children:['"',t.replace("-"," "),'" ']}),"on ",w.BASE_URI,". They can also go to ",Object(P.jsx)("a",{href:"".concat(w.BASE_URI,"/").concat(t),children:"".concat(w.BASE_URI,"/").concat(t)})," directly."]})]})})}var Re,Ne=n(128),qe=n(368),De=n(220),Fe=n(362);function Ue(e){var t=e.show,n=e.track,r=e.handler;return null===n?null:Object(P.jsxs)(Fe.a,{show:t,children:[Object(P.jsx)(Fe.a.Header,{children:Object(P.jsx)(Fe.a.Title,{children:"Nominating Song"})}),Object(P.jsxs)(Fe.a.Body,{children:["Do you want to spend ",Object(P.jsxs)("b",{children:["1 ",w.MONEY_SINGULAR]})," to nominate this song?",Object(P.jsx)("br",{}),Object(P.jsx)(ke,{track:n})]}),Object(P.jsxs)(Fe.a.Footer,{children:[Object(P.jsx)(D.a,{variant:"outline-secondary",onClick:function(){return r(!1)},children:"Close"}),Object(P.jsxs)(D.a,{variant:"dark",onClick:function(){return r(!0)},children:["Submit\xa0 ",Object(P.jsxs)(_e.a,{bg:"primary",pill:!0,children:["-1 ",Object(P.jsx)(he.c,{})]})]})]})]})}function Be(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.soupId,n=e.eventHandler,c=void 0===n?function(){}:n,a=Object(r.useState)(""),o=Object(u.a)(a,2),i=o[0],s=o[1],l=Object(r.useState)([]),j=Object(u.a)(l,2),p=j[0],h=j[1],b=Object(r.useState)(!1),f=Object(u.a)(b,2),O=f[0],x=f[1],g=Object(r.useState)(null),y=Object(u.a)(g,2),m=y[0],v=y[1],_=Object(r.useState)(!1),k=Object(u.a)(_,2),S=k[0],A=k[1],E=I();function C(){re.request("/search",{params:{q:i,type:"track",limit:6}}).then((function(e){console.log(e),e&&h(e.data.tracks.items)}))}function R(e){v(e),x(!0)}function F(e){x(!1),e&&!S&&(A(!0),T.findById(E).then((function(e){if(e.money<1)throw alert("You're too broke! Wait a few minutes for your ".concat(w.MONEY_PLURAL," to be replenished.")),Error("Silent");var t=e.money-1;return T.update({_id:E},{money:t}).then((function(e){return c("updateUser"),c("selectedTrack",m),e}))})).then((function(){return G.findById(t)})).then((function(e){var t=[{votes:5,track:m}].concat(Object(d.a)(e.queue));return c("updateQueue",t),G.update({_id:e._id},{queue:t})})).catch((function(e){if("silent"===e.message.toLowerCase())return e;throw e})).finally((function(){A(!1)})),E.money<1)&&console.log("no money!")}function U(e,t){var n=new De.Time(e.duration_ms);return Object(P.jsxs)(qe.a.Item,{className:"d-flex justify-content-between align-items-start",action:!0,onClick:function(){return R(e)},children:[Object(P.jsxs)("div",{children:[Object(P.jsxs)("div",{className:"fw-bold",children:[e.name,"\xa0",e.explicit&&Object(P.jsx)(_e.a,{bg:"secondary",children:"Explicit"}),"\xa0",e.popularity>75&&Object(P.jsx)(Ne.a,{size:"1.3em",style:{color:"#ff8c00"}}),e.popularity>83&&Object(P.jsx)(Ne.a,{size:"1.3em",style:{color:"#ff8c00"}}),e.popularity>92&&Object(P.jsx)(Ne.a,{size:"1.3em",style:{color:"#ff8c00"}})]}),Object(P.jsx)("div",{children:e.artists.map((function(e){return e.name})).join(", ")})]}),Object(P.jsx)("div",{style:{fontFamily:"monospace"},children:n.toString("s")})]},t)}return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(N.a,{children:Object(P.jsx)(q.a,{placeholder:"Type to search...",value:i,onChange:function(e){return s(e.target.value)}})}),Object(P.jsx)(D.a,{onClick:C,children:"Search"}),Object(P.jsx)("br",{}),Object(P.jsx)(qe.a,{children:p.map(U)}),Object(P.jsx)(Ue,{show:O,track:m,handler:F})]})}var Le=function(){var e=Object(h.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re.request("/me/player/recently-played",{params:{limit:1}});case 2:return n=e.sent,e.abrupt("return",null===(t=n.data.items[0])||void 0===t?void 0:t.track);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ye=function(){var e=Object(h.a)(p.a.mark((function e(t,n,r){var c,a,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re.request("/me/player");case 2:return c=e.sent,e.next=5,Le();case 5:if(a=e.sent,o=a.uri,console.log("LAST PLAYED IS ",o),console.log("PLAYER STATE ",c.data),c.data.is_playing){e.next=15;break}return console.log("\ud83d\udea8 Nothing playing! Calling",t.toString()),clearInterval(Re),Re=null,t(),e.abrupt("return");case 15:console.log("STATE",c);case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Me="TRACK_END";function Ke(e){return ze.apply(this,arguments)}function ze(){return(ze=Object(h.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",re.request("/me/player/play",{method:"put",data:{uris:[t]}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function We(){return(We=Object(h.a)(p.a.mark((function e(t){var n,r,c,a,o=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=n.offsetMs,void 0===r?0:r,n.currentUri,console.group("playTrack"),e.next=4,re.request("/me/player");case 4:if(c=e.sent,console.log({playerState:c}),204!==c.status){e.next=13;break}return e.next=9,Le();case 9:if(e.sent.uri===t){e.next=13;break}return console.log("\u25b6\ufe0f Playing current track as its not the last track played already"),e.abrupt("return",Ke(t));case 13:if(c.data.item.uri!==t){e.next=17;break}return console.log("song is playing right now, will not re-play",c.data),console.groupEnd(),e.abrupt("return");case 17:return console.log("\ud83c\udf10 Making request to Spotify to play track"),e.next=20,Ke(t);case 20:a=e.sent,console.log("\ud83c\udfb5\ud83c\udfb5 Response from play request",a),console.groupEnd();case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var He=function(e){var t=e.eventHandler,n=e.soupId;if(!n)return Object(P.jsx)(C,{});var r=function(){var e=Object(h.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",G.update({_id:n},t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(P.jsx)(be.Consumer,{children:function(e){if(null===e)return Object(P.jsx)("div",{children:"Talking to Spotify.."});console.group("Player:onValueChange");var n=e.isPlaying,c=e.track,a=e.startFrom,o=e.updateSpotify;return console.log("new values",{isPlaying:n,track:c,startFrom:a,updateSpotify:o}),n?c?(console.log("sending to playTrack with uri ",c.uri),function(e){return We.apply(this,arguments)}(c.uri).catch((function(e){t("ERROR_PLAY_FAILED",e)})).then((function(){var e;return e=function(){return t(Me)},console.log("starting player check loop"),Re||(Re=setInterval((function(){return Ye(e)}),7200)),setTimeout((function(){return Ye((function(){return t(Me)}))}),c.duration_ms-800),r({isPlaying:!0,duration:c.duration_ms,startedAt:new Date})})),console.groupEnd(),Object(P.jsx)(ke,{track:c})):(console.log("there is no track, so send TRACK_END event"),console.groupEnd(),t(Me),Object(P.jsx)("div",{children:"Getting next song..."})):Object(P.jsx)("div",{children:"paused"})}})};n(346);function Ve(){var e=Object(o.w)().id,t=Object(r.useState)(null),n=Object(u.a)(t,2),c=n[0],a=n[1],i=Object(r.useState)(null),s=Object(u.a)(i,2),d=s[0],j=s[1],b=Object(r.useState)(!1),f=Object(u.a)(b,2),O=f[0],x=f[1],y=Object(r.useState)(null),m=Object(u.a)(y,2),v=m[0],_=m[1],k=Object(r.useState)(null),S=Object(u.a)(k,2),A=S[0],E=S[1],N=Object(r.useState)(!1),q=Object(u.a)(N,2),F=q[0],U=q[1],B=Object(r.useState)("songs"),L=Object(u.a)(B,2),Y=L[0],M=L[1],K=I();Object(r.useEffect)((function(){if(null===c)return T.findById(K).then((function(t){return _(t,[c,K,e])})),G.findById(e).then((function(e){if(!e)return console.log("setting error"),j(404);a(e),E({isPlaying:e.isPlaying,track:e.currentTrack,updateSpotify:!0}),e.queue.length||M("new"),function(){var e=function(){var t=Object(h.a)(p.a.mark((function t(){var n,r,c,a,o,i;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=+localStorage.getItem(xe),r=Date.now(),!(n+ge<r)){t.next=15;break}return c=3*Math.floor((r-n)/ge),a=localStorage.getItem("_id"),t.next=7,T.findById(a);case 7:return o=t.sent,i=o.money+c<w.MAX_MONEY?o.money+c:w.MAX_MONEY,t.next=11,T.update({_id:a},{money:i});case 11:localStorage.setItem(xe,Date.now()),ye=setTimeout(e,ge),t.next=17;break;case 15:return ye=setTimeout(e,n+ge-r),t.abrupt("return",ye);case 17:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();if(null===ye)return e();console.error("startMoneyLoop - cannot start loop when already running")}()})),me}));var z=function(t,n){if(!O)if("updateUser"===t)T.findById(K).then((function(t){return _(t,[c,K,e])}));else if("updateQueue"===t)console.log("updating main queue data",n),a(Object(l.a)(Object(l.a)({},c),{queue:n})),M("songs");else if(["up","down"].includes(t)){x(!0),g()(c.queue,(function(e){return e.track.id===n.track.id})).votes+="up"===t?1:-1,c.queue=(c.queue,Oe()(c.queue,"votes").reverse()),G.update({_id:c._id},{queue:c.queue}).then((function(){return a(c)})).finally((function(){return x(!1)}))}};if(d)return console.log(d),404===d?Object(P.jsxs)(R,{children:[Object(P.jsxs)("h1",{children:["Quarry not found ",Object(P.jsx)("code",{children:"404"})]}),Object(P.jsx)("p",{children:"It might have been deleted. Or we might've screwed up (probs not tbh)"}),Object(P.jsx)("p",{children:Object(P.jsx)("a",{href:"/",children:"Back to the pantry"})})]}):Object(P.jsxs)(R,{children:[Object(P.jsx)("h1",{children:"Uh oh"}),Object(P.jsx)("p",{children:"Don't look at me."}),Object(P.jsx)("p",{children:Object(P.jsx)("a",{href:"/",children:"Just go away"})})]});if(null===c)return Object(P.jsx)(C,{});var W=Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(he.c,{})," ",null===v||void 0===v?void 0:v.money]}),H=!c.queue.length&&!c.currentTrack;return Object(P.jsx)(be.Provider,{value:A,children:Object(P.jsxs)(R,{align:"left",children:[Object(P.jsxs)("section",{children:[Object(P.jsxs)("span",{className:"header",children:[Object(P.jsxs)("h2",{children:[c.name," "]}),Object(P.jsx)(Ae.a,{placement:"bottom",delay:150,overlay:function(e){return Object(P.jsx)(Ee.a,Object(l.a)(Object(l.a)({},e),{},{children:"Add a song first"}))},children:Object(P.jsx)(D.a,{variant:"success",disabled:H,onClick:function(){var e=!A.isPlaying;E(Object(l.a)(Object(l.a)({},A),{},{isPlaying:e,updateSpotify:!0})),G.update({_id:c._id},{isPlaying:e}).catch(console.error)},children:Object(P.jsx)(he.b,{})})})]}),Object(P.jsx)("h4",{children:"number"===typeof(null===v||void 0===v?void 0:v.money)?W:" "})]}),Object(P.jsx)(Ce,{phrase:c.phrase}),Object(P.jsx)("br",{}),Object(P.jsx)(He,{eventHandler:function(e){if(console.log("# player event #"),"TRACK_END"===e){var t;if(F)return void console.info("player locked");U(!0),console.group("onPlayerEvent:TRACK_END"),console.log("getting next track");var n=null===(t=c.queue.pop())||void 0===t?void 0:t.track;if(console.log("next track is ",n),!n)return console.info("no next track, pausing"),E(Object(l.a)(Object(l.a)({},A),{},{isPlaying:!1,updateSpotify:!0})),U(!1),G.update({_id:c._id},{isPlaying:!1}).catch(console.error),void console.groupEnd();console.log("SOUP; updating with next track",n),G.update({_id:c._id},{queue:c.queue,currentTrack:n,startedAt:new Date,isPlaying:A.isPlaying}).then((function(){return a(c)})).then((function(){console.log("setting player values"),E(Object(l.a)(Object(l.a)({},A),{},{track:n,startAt:0}))})).catch((function(e){alert(e),E(Object(l.a)(Object(l.a)({},A),{},{isPlaying:!1}))})).finally((function(){console.groupEnd(),U(!1)}))}},soupId:null===c||void 0===c?void 0:c._id}),Object(P.jsxs)(Te.a,{activeKey:Y,onSelect:M,className:"mb-3",children:[Object(P.jsx)(Ie.a,{eventKey:"songs",title:Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(he.a,{})," Songs"]}),children:Object(P.jsx)(we,{songs:c.queue,onVote:z})}),Object(P.jsx)(Ie.a,{eventKey:"new",title:Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(pe.b,{})," New "]}),children:Object(P.jsx)(Be,{eventHandler:z,soupId:e})})]})]})})}var Ge={display:"flex",justifyContent:"center"};var Je=function(){return Object(i.a)({apiKey:"AIzaSyDQfAAJqtKOKXEdRL1SfqS3Pj8VjAIqvzE",authDomain:"music-mining.firebaseapp.com",projectId:"music-mining",storageBucket:"music-mining.appspot.com",messagingSenderId:"616247216727",appId:"1:616247216727:web:13e1f76d2cc06a0ab3f112"}),Object(P.jsx)("div",{className:"App",style:Ge,children:Object(P.jsxs)(o.f,{children:[Object(P.jsx)(o.d,{path:"/",element:Object(P.jsx)(F,{})}),Object(P.jsx)(o.d,{path:"/spotifyConnect",element:Object(P.jsx)(le,{})}),Object(P.jsx)(o.d,{path:"/callback",element:Object(P.jsx)(le,{})}),Object(P.jsx)(o.d,{path:"/soup/new",element:Object(P.jsx)(J,{})}),Object(P.jsx)(o.d,{path:"/soup/:id",element:Object(P.jsx)(Ve,{})}),Object(P.jsx)(o.d,{path:"/:phrase",element:Object(P.jsx)(je,{})})]})})},Qe=(n(349),{apiKey:"AIzaSyDQfAAJqtKOKXEdRL1SfqS3Pj8VjAIqvzE",authDomain:"music-mining.firebaseapp.com",projectId:"music-mining",storageBucket:"music-mining.appspot.com",messagingSenderId:"616247216727",appId:"1:616247216727:web:13e1f76d2cc06a0ab3f112"});console.log("Initializing Firebase app with config",Qe);var Xe=Object(i.a)(Qe);Object(y.a)(Xe);c.render(Object(P.jsx)(a.BrowserRouter,{children:Object(P.jsx)(Je,{})}),document.getElementById("root"))}},[[350,1,2]]]);
//# sourceMappingURL=main.c7d3f5f7.chunk.js.map