{"version":3,"sources":["database/getDatabase.js","constants.js","models/orm.js","models/User.js","auth/identity.js","components/Loading.jsx","components/MobilishView.jsx","views/SelectAQuarry.js","util/searchPhrase.js","models/Quarry.js","views/NewQuarry.js","externalApis/spotify.js","views/ConnectSpotify.jsx","views/QuarryFromUrl.jsx","routines/moneyReplenish.js","components/TrackPreview.jsx","components/SongQueueListItem.jsx","components/SongQueue.jsx","components/QuarrySharing.jsx","components/ConfirmSongSelection.jsx","components/SongSelector.jsx","views/Quarry.jsx","App.js","index.js"],"names":["db","getDatabase","getFirestore","process","NODE_ENV","constants","APP_NAME","BASE_URI","REACT_APP_BASE_URI","SPOTIFY_API","SPOTIFY_ACCOUNTS_API","SPOTIFY_CLIENT_ID","REACT_APP_CLIENT_ID","MONEY_SINGULAR","MONEY_PLURAL","MAX_MONEY","SPOTIFY_REDIRECT_URI","module","exports","debug","localStorage","getItem","args","console","log","stack","Error","group","label","groupEnd","ORM","connection","_dbconnection","name","schema","_models","model","Model","getdbFn","this","_schema","_collection","_getdb","_hooks","preCreate","hook","document","Object","entries","key","value","keys","join","Array","isArray","a","fetchDoc","validate","addDoc","collection","snapshot","findById","id","cache","queryObj","_id","ref","q","query","convertObjectToWhereClauses","getDocs","docs","length","undefined","doc","find","documentSnapshotToObject","map","docRef","getDoc","getDocFromServer","findOne","create","updateObj","updates","updateDoc","update","push","obj","clauses","where","data","UserSchema","money","Number","score","displayName","String","User","user","useUser","useState","setUser","useEffect","findOrCreate","then","setItem","Loading","ui","setUi","setTimeout","MobilishView","props","children","style","width","midWidth","align","textAlign","className","SelectAQuarry","navigate","useNavigate","type","placeholder","onClick","SHORT_ADJECTIVES","SHORT_NOUNS","twoWordPhrase","Math","floor","random","QuarrySchema","leader","queue","phrase","created","Quarry","quarry","Date","NewQuarry","setPhrase","validated","setValidated","quarryName","setQuarryName","submitting","setSubmitting","handleSubmit","event","currentTarget","checkValidity","preventDefault","stopPropagation","Form","noValidate","onSubmit","action","Group","controlId","Label","Control","required","onChange","target","InputGroup","Text","FormControl","fontFamily","color","readOnly","aria-label","Button","variant","disabled","ACCESS_TOKEN","REFRESH_TOKEN","storage","val","spotify","axios","_createAxiosWithSpotifyAuth","baseURL","headers","accessToken","refreshToken","code","codeVerifier","params","URLSearchParams","append","ACCESS_TOKEN_URL","url","method","res","setAccessToken","access_token","setRefreshToken","refresh_token","response","error","message","requestAccessTokenFromRefreshToken","request","grant_type","client_id","alert","window","location","href","CODE_VERIFIER","pkceChallenge","code_verifier","code_challenge","authParams","AUTH_URL","toString","ConnectSpotify","useLocation","searchParams","search","get","setTokensWithCode","catch","e","useParams","require","QuarryFromUrl","test","setQuarry","LAST_UPDATE","INTERVAL","loopId","stopMoneyLoop","clearTimeout","warn","TrackPreview","track","margin","src","album","images","alt","explicit","Badge","bg","artists","SongQueueListItem","votes","onVote","SongQueue","songs","onVoteHandler","Card","s","Title","QuarrySharing","Accordion","defaultActiveKey","Item","eventKey","Header","Body","replace","ConfirmSongSelection","show","handler","Modal","Footer","pill","SongSelector","soupId","eventHandler","setQuery","tracks","setTracks","showConfirm","setShowConfirm","selectedTrack","setSelectedTrack","submittingSong","setSubmittingSong","doSearch","limit","items","handleSelected","handleConfirmation","isConfirmed","userDoc","updatedMoney","soup","updateQueue","toLowerCase","finally","renderTrack","time","Time","duration_ms","ListGroup","popularity","size","quarryId","errorCode","setErrorCode","updating","setUpdating","myId","QuarryModel","loop","lastUpdate","now","moneyToGive","adjustedMoney","startMoneyLoop","songSelectorEvent","includes","songToUpdate","o","sortBy","reverse","userMoneyStat","Tabs","Tab","title","justifyContent","App","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","path","element","connectFirestoreEmulator","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.477b2493.chunk.js","sourcesContent":["import {getFirestore} from \"firebase/firestore\";\n\nif (process.NODE_ENV === 'development') {\n  // const db = getFirestore();\n}\n\nlet db;\n\nexport default function getDatabase() {\n  if (db) {\n    return db;\n  }\n  db = getFirestore();\n  return db;\n}\n\n","\nconst constants =  {\n  APP_NAME: 'JukeSoup',\n  BASE_URI: process.env.REACT_APP_BASE_URI || 'http://localhost:3000',\n  SPOTIFY_API: 'https://api.spotify.com/v1',\n  SPOTIFY_ACCOUNTS_API: 'https://accounts.spotify.com',\n  SPOTIFY_CLIENT_ID: process.env.REACT_APP_CLIENT_ID,\n  MONEY_SINGULAR: 'ticket',\n  MONEY_PLURAL: 'tickets',\n  MAX_MONEY: 20\n}\nconstants.SPOTIFY_REDIRECT_URI = `${constants.BASE_URI}/callback`;\n\nmodule.exports = constants;\n","import { collection, addDoc, query, where, updateDoc, getDocs, getDoc, getDocFromServer, doc } from \"firebase/firestore\";\nimport find from 'lodash.find';\nimport getDatabase from '../database/getDatabase';\n\nconst debug = (...args) => {\n  if (localStorage.getItem('ORMDEBUG')) {\n    console.log('[ORM:DEBUG]', ...args, {stack: new Error()});\n  }\n}\ndebug.group = (label) => console.group(label);\ndebug.groupEnd = () => console.groupEnd();\n\nexport class ORM {\n\n  static _models = {}\n  static _dbconnection = getDatabase;\n\n  /**\n   * @param {Function} connection - the firestore connection function\n   */\n  static setDb(connection) {\n    debug('Setting db connection to', connection);\n    ORM._dbconnection = connection;\n  }\n\n  static model(name, schema) {\n\n    if (!schema) {\n      return ORM._models[name];\n    }\n    const model = new Model(name, schema, ORM._dbconnection);\n    ORM._models[name] = model;\n    return model;\n  }\n}\n\nclass Model {\n  constructor(name, schema, getdbFn) {\n    this._schema = schema;\n    this._collection = name;\n    this._getdb = getdbFn;\n    this._hooks = {\n      preCreate: () => {},\n    }\n  }\n\n  // hooks\n  preCreate(hook) {\n    this._hooks.preCreate = hook;\n  }\n\n  /**\n   * Very primitive validation\n   * @param {object} document\n   * @returns {*}\n   */\n  validate(document) {\n    const documentEntries = Object.entries(document);\n    for (const [key, value] of documentEntries) {\n      if (key === '_id') {\n        continue;\n      }\n      console.log(key, this._schema[key]);\n      if (!this._schema[key]) {\n        throw Error(`document has extra property '${key}'\n        Schema keys are ${Object.keys(this._schema).join(', ')}`);\n      }\n      if (Array.isArray(this._schema[key])) {\n        // TODO: validate the type inside the array schema with items in the document array\n        if (!Array.isArray(value)) {\n          throw Error(`Expected ${key} to be an Array but was ${typeof value}`);\n        }\n      } else if (typeof this._schema[key]() !== typeof value) {\n        throw Error(`Expected '${key}' to be type ${typeof this._schema[key]()}, but was ${typeof value}\n        Schema keys are ${Object.keys(this._schema).join(', ')}`);\n      }\n    }\n    return document;\n  }\n\n  async create(document = {}, {fetchDoc = true} = {}) {\n    debugger;\n    debug('creating document ', document);\n    this._hooks.preCreate(document);\n    this.validate(document);\n    const db = this._getdb();\n    const snapshot = await addDoc(collection(db, this._collection), document);\n    if (fetchDoc) {\n      debug('fetching document');\n      return this.findById(snapshot.id, {cache: false});\n    }\n    return snapshot;\n  }\n\n  /**\n   * @param {object} queryObj - simplified AND'ed obect or sql like string\n   * @params {{document: boolean}} - if you want the actual document or snapshopt (for more firestore ops)\n   * @returns {Promise<void>}\n   */\n  async find(queryObj, {document = true} = {}) {\n    debug.group('find');\n    debug('called with query', queryObj);\n    let _id;\n    if (queryObj._id) {\n      _id = queryObj._id;\n      delete queryObj._id;\n    }\n    const db = this._getdb();\n    debug('using db', db);\n    const ref = collection(db, this._collection);\n    debug('using collection', ref);\n    const q = query(ref, ...convertObjectToWhereClauses(queryObj));\n    const snapshot = await getDocs(q);\n    if (!snapshot.docs?.length) {\n      debug('find: no query found');\n      debug.groupEnd();\n      return undefined;\n    }\n    console.log('SNAP ', snapshot);\n    if (_id) {\n      const doc = find(snapshot.docs, (doc) => doc.id === _id);\n      debug('found doc (by id): ', doc);\n      debug.groupEnd();\n      return document ? [documentSnapshotToObject(doc)] : [doc];\n    }\n    debug('found docs (as snapshots):', snapshot.docs);\n    debug.groupEnd();\n    return document ? snapshot.docs.map(documentSnapshotToObject) : snapshot.docs;\n  }\n\n  async findOne(queryObj, {document = true} = {}) {\n    debug.group('findOne');\n    const docs = await this.find(queryObj, {document});\n    if (!docs) {\n      debug('no docs found');\n      debug.groupEnd();\n      return;\n    }\n    debug(`fond ${docs.length} docs, first one is `, docs[0]);\n    debug.groupEnd();\n    return docs[0];\n  }\n  async findById(id, { cache = true, document = true} = {}) {\n    debug.group('findById');\n    debug('using id ', id, {cache}, this._collection);\n    const db = this._getdb();\n    const docRef = doc(db, `/${this._collection}/${id}`);\n    const snapshot = await (cache ? getDoc(docRef) : getDocFromServer(docRef));\n    debug.groupEnd();\n    if (!document) {\n      debug('returning snapshot rather than document');\n      return document;\n    }\n    return documentSnapshotToObject(snapshot);\n  }\n\n  async findOrCreate(queryObj) {\n    debug.group('findOrCreate');\n    debug('called with queryObj =', queryObj);\n    const doc = await this.findOne(queryObj);\n    if (!doc) {\n      if (!queryObj._id) {\n        delete queryObj._id;\n      }\n      debug('doc not found, creating.');\n      const doc = await this.create(queryObj);\n      debug.groupEnd();\n      return doc;\n    }\n    debug('Found doc:', doc);\n    debug.groupEnd();\n    return doc;\n  }\n\n  async update(queryObj, updateObj) {\n    debug.group('update');\n    const document = await this.findOne(queryObj);\n    if (!document) {\n      debug('Could not find doc!');\n      debug.groupEnd();\n      return null;\n    }\n    const db = this._getdb();\n    const docRef = doc(db, `/${this._collection}/${document._id}`);\n    debug.groupEnd();\n    let updates = [];\n    for (const [key, value] of Object.entries(updateObj)) {\n      const update = await updateDoc(docRef, key, value);\n      updates.push(update);\n    }\n    return updates;\n  }\n}\n\n/**\n * @param obj - queryObject\n * @returns {*[]} clauses\n */\nfunction convertObjectToWhereClauses(obj) {\n  const clauses = [];\n  for (const [key, value] of Object.entries(obj)) {\n    clauses.push(where(key, '==', value));\n  }\n  return clauses;\n}\n\n/** takes a DocumentSnapshot https://firebase.google.com/docs/reference/js/firestore_lite.documentsnapshot.md\n * and adds the id to the document as _id (like with mongoose)\n * @param snapshot\n */\nfunction documentSnapshotToObject(snapshot) {\n  const data = snapshot?.data();\n  if (!data) {\n    return;\n  }\n  return { ...snapshot.data(), _id: snapshot.id };\n}\n","import { ORM } from './orm';\nimport { MAX_MONEY } from '../constants';\n\nconst UserSchema = {\n  money: Number,\n  score: Number,\n  displayName: String\n}\n\nconst User = ORM.model('User', UserSchema);\nUser.preCreate((user) => {\n  user.score = user.score || 0;\n  user.money = user.money ?? MAX_MONEY;\n});\n\nexport default User;\n","import { useState, useEffect } from 'react';\nimport User from '../models/User';\n\nexport default function useUser() {\n  const [user, setUser] = useState(null);\n\n  useEffect(() => {\n    const _id = localStorage.getItem('_id');\n    User.findOrCreate({_id})\n      .then(user => {\n        localStorage.setItem('_id', user._id);\n        setUser(_id);\n      })\n  });\n\n  return user;\n}\n\nexport function getCurrentUserId() {\n  return localStorage.getItem('_id');\n}\n","import {useState} from 'react';\n\nexport default function Loading() {\n\n    const [ui, setUi] = useState('');\n\n    setTimeout(() => setUi(<div>Loading</div>), 1200);\n\n    return <>{ui}</>\n}\n","\n/** Simple container that restricts the width to a bit more than mobile. Most\n * (if not all) views should be wrapped in this.\n */\nexport function MobilishView(props) {\n  const { children } = props;\n  const style = {width: '520px', midWidth: '200px'};\n  if (props.align) {\n    style.textAlign = props.align;\n  }\n  return <div className='mobilish' style={style}>{children}</div>\n}\n","// import '../style/input.css';\nimport { useNavigate } from \"react-router-dom\";\n\nimport useUser from \"../auth/identity\";\nimport Loading from \"../components/Loading\";\nimport {MobilishView} from \"../components/MobilishView\";\n\nfunction SelectAQuarry(props) {\n    const navigate = useNavigate();\n    const user = useUser();\n    if (user === null) {\n      return <Loading/>\n    }\n    return (\n        <MobilishView>\n            <h1>Find a Quarry</h1>\n            <input type=\"text\"\n                   className='input-center'\n                   placeholder='two words (e.g. \"shining-pearl\")'/> | <button>Enter</button>\n            <br/>\n            <hr/>\n            <h3>or <button onClick={() => navigate('/quarry/new')}>create one</button></h3>\n        </MobilishView>\n    );\n}\n\nexport default SelectAQuarry\n","const SHORT_ADJECTIVES = [\n  'shining',\n  'cool',\n  'fun',\n  'rad',\n  'good',\n  'nice',\n  'helpful',\n  'hip',\n  'musical',\n  'kind',\n  'free',\n  'great',\n  'bad',\n  'hot',\n  'cold',\n  'warm',\n  'frozen',\n  'tall',\n  'short',\n  'quick',\n  'red',\n  'green',\n  'blue',\n  'square',\n  'smart',\n  'long',\n  'rich',\n  'calm',\n  'windy',\n  'round',\n  'solid',\n  'liquid',\n  'meta',\n  'cyber',\n  'swanky',\n  'fruity'\n];\n\nconst SHORT_NOUNS = [\n  'pearl',\n  'mom',\n  'dad',\n  'daddy',\n  'boy',\n  'girl',\n  'car',\n  'trick',\n  'mine',\n  'quarry',\n  'pot',\n  'egg',\n  'seltzer',\n  'gas',\n  'power',\n  'iphone',\n  'salt',\n  'pepper',\n  'bed',\n  'table',\n  'soda',\n  'chair',\n  'rug',\n  'bean',\n  'ice',\n  'yoyo',\n  'rug',\n  'can',\n  'wheel',\n  'yoga',\n  'button',\n  'stick',\n  'fire',\n  'rain',\n  'sun',\n  'god',\n  'gold',\n  'cup',\n  'app',\n  'bread',\n  'box',\n  'toy',\n  'tea'\n]\n\nexport default function twoWordPhrase() {\n  return [\n    SHORT_ADJECTIVES[Math.floor(Math.random() * SHORT_ADJECTIVES.length)],\n    SHORT_NOUNS[Math.floor(Math.random() * SHORT_NOUNS.length)]\n  ];\n}\n","import { ORM } from './orm';\n\nconst QuarrySchema = {\n  leader: String,\n  name: String,\n  queue: [],\n  phrase: String,\n  created: Object // Date TODO date validation?\n}\n\nconst Quarry = ORM.model('Quarry', QuarrySchema);\nQuarry.preCreate((quarry) => {\n  quarry.queue = []\n  quarry.created = new Date();\n});\n\nexport default Quarry;\n","import { useState } from 'react';\nimport {Form, InputGroup, Button, FormControl} from 'react-bootstrap';\nimport { FiRefreshCw } from 'react-icons/fi'\nimport { useNavigate } from 'react-router-dom';\nimport Loading from \"../components/Loading\";\nimport useUser from '../auth/identity';\nimport {MobilishView} from \"../components/MobilishView\";\nimport twoWordPhrase from '../util/searchPhrase';\nimport Quarry from \"../models/Quarry\";\n\nexport default function NewQuarry(props) {\n\n  const navigate = useNavigate();\n  const user = useUser();\n\n  const [phrase, setPhrase] = useState(twoWordPhrase());\n  const [validated, setValidated] = useState(false);\n  const [quarryName, setQuarryName] = useState('');\n  const [submitting, setSubmitting] = useState(false);\n\n  const updateQuarryName = (event) => {\n    setQuarryName(event.target.value);\n  }\n\n  const handleSubmit = (event) => {\n    const form = event.currentTarget;\n    if (form.checkValidity() === false) {\n      event.preventDefault();\n      event.stopPropagation();\n      return;\n    }\n    setValidated(true);\n\n    // TODO this should be handled with form validation\n    if (!quarryName) {\n      return;\n    }\n    setSubmitting(true);\n\n    // TODO probably re-validate user exists before creating\n    Quarry.create({\n      leader: user,\n      phrase: phrase.join('-'),\n      name: quarryName\n    })\n      .then(data => {\n        console.log('new quarry', data);\n        navigate(`/quarry/${data._id}`);\n      })\n  }\n\n  if (user === null) {\n    return <Loading/>\n  }\n\n  return (\n    <MobilishView>\n      <h1>Open a Quarry. Discover Music.</h1>\n      <Form noValidate validated={validated} onSubmit={handleSubmit} action=''>\n        <Form.Group controlId='name'>\n          <Form.Label>Quarry Name</Form.Label>\n          <Form.Control required type=\"input\" placeholder=\"(e.g. Nick's Soup)\" value={quarryName} onChange={updateQuarryName}/>\n        </Form.Group>\n        <br/>\n        <InputGroup style={{width: '480px'}}>\n          <InputGroup.Text>Your 2-word phrase:</InputGroup.Text>\n          <FormControl\n            style={{textAlign: 'center', fontFamily: 'monospace', color: 'red'}}\n            readOnly\n            value={phrase[0]}\n            aria-label=\"Recipient's username with two button addons\"\n          />\n          <FormControl\n            style={{textAlign: 'center', fontFamily: 'monospace', color: 'red'}}\n            readOnly\n            value={phrase[1]}\n            aria-label=\"Recipient's username with two button addons\"\n          />\n          <Button variant=\"outline-secondary\" onClick={() => setPhrase(twoWordPhrase())}><FiRefreshCw/></Button>\n        </InputGroup>\n        <Form.Text className=\"text-muted\">This is helps friends find you.</Form.Text>\n        <br/>\n        <Button className={submitting ? 'btn-secondary' : 'btn-success'}\n                type=''\n                onClick={handleSubmit}\n                disabled={submitting}> {!submitting ? 'Create' : 'working üí¶'}</Button>\n      </Form>\n    </MobilishView>\n  )\n}\n","import axios from 'axios';\nimport {SPOTIFY_ACCOUNTS_API, SPOTIFY_API, SPOTIFY_CLIENT_ID, SPOTIFY_REDIRECT_URI} from '../constants';\n\nconst ACCESS_TOKEN = 'spotifyAccessToken_DO_NOT_SHARE';\nconst REFRESH_TOKEN = 'spotifyRefreshToken';\n\nclass Storage {\n  get accessToken() {\n    return localStorage.getItem(ACCESS_TOKEN);\n  }\n  set accessToken(val) {\n    localStorage.setItem(ACCESS_TOKEN, val);\n  }\n  get refreshToken() {\n    return localStorage.getItem(REFRESH_TOKEN);\n  }\n  set refreshToken(val) {\n    localStorage.setItem(REFRESH_TOKEN, val);\n  }\n}\n\nconst storage = new Storage();\n\nclass AxiosWithSpotifyAuth {\n  constructor() {\n    this.axios = this._createAxiosWithSpotifyAuth();\n  }\n  _createAxiosWithSpotifyAuth() {\n    return axios.create({\n      baseURL: SPOTIFY_API,\n      headers: {\n        'Authorization': `Bearer ${storage.accessToken}`\n      }\n    })\n  }\n  setAccessToken(accessToken) {\n    storage.accessToken = accessToken;\n    this.axios = this._createAxiosWithSpotifyAuth();\n  }\n  setRefreshToken(refreshToken) {\n    storage.refreshToken = refreshToken;\n    this.axios = this._createAxiosWithSpotifyAuth();\n  }\n\n  async setTokensWithCode(code, codeVerifier) {\n    const params = new URLSearchParams();\n    params.append('grant_type', 'authorization_code');\n    params.append('code', code);\n    params.append('redirect_uri', SPOTIFY_REDIRECT_URI);\n    params.append('client_id', SPOTIFY_CLIENT_ID);\n    params.append('code_verifier', codeVerifier);\n    const ACCESS_TOKEN_URL = `${SPOTIFY_ACCOUNTS_API}/api/token`;\n    const res = await axios({\n      url: ACCESS_TOKEN_URL,\n      method: 'post',\n      data: params,\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }\n    });\n    this.setAccessToken(res.data.access_token);\n    this.setRefreshToken(res.data.refresh_token);\n    return res;\n  }\n\n  async request(...args) {\n    let res;\n    try {\n      res = await this.axios(...args);\n    } catch (e) {\n      if (e.response?.data.error.message === \"The access token expired\") {\n        console.log('access token expired, trying new token');\n        await this.requestAccessTokenFromRefreshToken();\n        return this.request(...args);\n      }\n    }\n    return res;\n  }\n\n  async requestAccessTokenFromRefreshToken() {\n    console.log('starting refresh flow')\n    const params = new URLSearchParams({\n      grant_type: 'refresh_token',\n      refresh_token: storage.refreshToken,\n      client_id: SPOTIFY_CLIENT_ID,\n    });\n    try {\n      const res = await axios({\n        url: `${SPOTIFY_ACCOUNTS_API}/api/token`,\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        data: params\n      });\n      storage.accessToken = res.data.access_token;\n      storage.refreshToken = res.data.refresh_token;\n      return res;\n    } catch(e) {\n      if (e.message === 'Request failed with status code 400') {\n        alert('Please reconnect Spotify');\n        window.location.href = '/spotifyConnect';\n      } else {\n        throw e;\n      }\n    }\n  }\n}\n\nconst spotify = new AxiosWithSpotifyAuth();\n\nexport default spotify;\n","import {APP_NAME} from '../constants';\nimport {Button} from 'react-bootstrap';\nimport {SPOTIFY_ACCOUNTS_API, SPOTIFY_CLIENT_ID, SPOTIFY_REDIRECT_URI} from '../constants';\nimport {useLocation, useNavigate} from 'react-router-dom';\nimport pkceChallenge from 'pkce-challenge';\n\nimport spotify from '../externalApis/spotify';\nimport Loading from \"../components/Loading\";\nimport {MobilishView} from \"../components/MobilishView\";\n\nconst CODE_VERIFIER = 'codeVerifier_DO_NOT_SHARE'\nconst { code_verifier, code_challenge } = pkceChallenge(48);\n\nconst authParams = new URLSearchParams();\nauthParams.append('client_id', SPOTIFY_CLIENT_ID);\nauthParams.append('response_type', 'code');\nauthParams.append('scope', 'user-read-playback-state user-modify-playback-state user-read-currently-playing');\nauthParams.append('redirect_uri', SPOTIFY_REDIRECT_URI);\nauthParams.append('code_challenge_method', 'S256');\nauthParams.append('code_challenge', code_challenge);\nconsole.log('using challenge ', code_challenge);\n\nconst AUTH_URL = `${SPOTIFY_ACCOUNTS_API}/authorize?${authParams.toString()}`;\n\nexport default function ConnectSpotify() {\n\n  const location = useLocation();\n  const navigate = useNavigate();\n  const searchParams = new URLSearchParams(location.search);\n  const code = searchParams.get('code');\n  const error = searchParams.get('error');\n\n  if (error) {\n    if (error === 'access_denied') {\n      return <h1>Oh.</h1>\n    }\n    return <>\n      <h1>Yikes.</h1>\n      <h6>Just walk away</h6>\n    </>\n  }\n\n  if (code) {\n    const code_verifier = localStorage.getItem(CODE_VERIFIER);\n\n    spotify.setTokensWithCode(code, code_verifier)\n      .then(data => {\n        console.log(data);\n        return spotify.axios('/me/player/currently-playing')\n      })\n      .then(() => navigate('/quarry/new'))\n      .catch((e) => console.error(e.message))\n    return <Loading/>\n  }\n\n  localStorage.setItem(CODE_VERIFIER, code_verifier);\n\n  return <MobilishView align='center'>\n    <h1>Connect Your Spotify Account</h1>\n    <p>Let {APP_NAME} control your music player on Spotify. Connect an account you plan on playing loud and\n      proud.</p>\n    <br/>\n    <Button variant='outline-dark' href={AUTH_URL}>Authorize with Spotify</Button>\n    <br/>\n    <br/>\n    <br/>\n    <small>We don't modify any data, such as playlists or liked songs (or anything else)</small>\n  </MobilishView>\n}\n","import Loading from \"../components/Loading\";\nimport Quarry from \"../models/Quarry\";\nimport {useState} from \"react\";\nimport {useNavigate} from \"react-router-dom\";\n\nconst { useParams } = require('react-router-dom');\n\nexport default function QuarryFromUrl() {\n  const { phrase } = useParams();\n  const navigate = useNavigate();\n  if (!/^\\w{1,10}-\\w{1,10}$/.test(phrase)) {\n    navigate('/');\n  }\n  const [ quarry, setQuarry ] = useState(null);\n  console.log('its ', phrase);\n\n  Quarry.find({phrase})\n    .then(quarry => {\n      if (quarry?.length === 1) {\n        navigate(`/quarry/${quarry[0]._id}`);\n      } else if (quarry?.length > 1 ) {\n        console.log('todo') // todo\n        setQuarry(quarry);\n      } else {\n        navigate('/');\n      }\n    })\n\n  if (quarry === null) {\n    return <Loading/>;\n  }\n\n  return <div>This is a list of soups (TODO)</div>\n\n}\n","import User from '../models/User';\nimport { getCurrentUserId } from \"../auth/identity\";\nimport { MAX_MONEY } from '../constants';\n\nconst LAST_UPDATE = 'lastMoneyUpdate';\nconst INTERVAL = 3 * 60 * 1000;\nconst MONEY_PER_INTERVAL = 3;\n\nlet loopId = null;\n\nexport function startMoneyLoop() {\n  const loop = async () => {\n    const lastUpdate = +localStorage.getItem(LAST_UPDATE);\n    const now = Date.now();\n    console.log({lastUpdate, INTERVAL, now});\n    if (lastUpdate + INTERVAL < now) {\n      const moneyToGive = Math.floor((now - lastUpdate) / INTERVAL) * MONEY_PER_INTERVAL;\n      const _id = getCurrentUserId();\n      const user = await User.findById(_id);\n      const adjustedMoney = user.money + moneyToGive < MAX_MONEY ? user.money + moneyToGive : MAX_MONEY;\n      await User.update({_id}, {money: adjustedMoney});\n      localStorage.setItem(LAST_UPDATE, Date.now());\n      loopId = setTimeout(loop, INTERVAL);\n    }\n    else {\n      console.log('now?? ', now);\n      console.log({INTERVAL})\n      console.log('last up?? ', lastUpdate);\n      console.log('not ready for money, will update in ', lastUpdate + INTERVAL - now);\n      loopId = setTimeout(loop, lastUpdate + INTERVAL - now);\n      return loopId;\n    }\n  }\n  if (loopId !== null) {\n    console.error('startMoneyLoop - cannot start loop when already running');\n    return;\n  }\n  console.log('starting loop');\n  return loop();\n}\n\nexport function stopMoneyLoop () {\n  if (loopId === null) {\n    console.warn('stopMoneyLoop - nothing to stop');\n    return;\n  }\n  clearTimeout(loopId);\n  loopId = null;\n}\n","import {Badge} from \"react-bootstrap\";\n\n\nexport default function TrackPreview({track}) {\n  console.log('PREVIEW FOR TRACK', track);\n  if (!track) {\n    return null;\n  }\n  return <div className='d-flex'>\n    <div style={{margin: '16px'}}>\n        <img\n            src={track.album.images[2].url}\n            alt='Track album'\n          />\n    </div>\n    <div style={{margin: '16px'}}>\n      <div className='fw-bold'>{track.name} {track.explicit && <Badge bg='secondary'>Explicit</Badge>}&nbsp;</div>\n      <div>{track.artists.map(a => a.name).join(', ')}</div>\n    </div>\n  </div>\n}\n","import { AiOutlineDown, AiOutlineUp } from 'react-icons/ai'\nimport TrackPreview from \"./TrackPreview\";\nimport '../style/songListQueueItem.css'\n\n\nexport default function SongQueueListItem ({ votes, track, onVote }) {\n\n  return <div className='container'>\n    <div className='voteWindow'>\n      <div className='clickable' onClick={() => onVote('up', {track})}><AiOutlineUp/></div>\n      <div><h3>{votes}</h3></div>\n      <div className='clickable' onClick={() => onVote('down', {track})}><AiOutlineDown/></div>\n    </div>\n    <div>\n      <TrackPreview track={track}/>\n    </div>\n  </div>\n\n}\n","import {Card} from \"react-bootstrap\";\nimport {FiMusic} from 'react-icons/fi';\nimport SongQueueListItem from './SongQueueListItem';\n\nexport default function SongQueue (props) {\n  const { songs, onVote } = props;\n\n  if (!songs) {\n    throw Error('SongQueue component must have props `songs`');\n  }\n\n  const onVoteHandler = (...args) => onVote(...args);\n\n  if (!songs.length) {\n    return <>\n      <Card>\n        <Card.Title><FiMusic/> No songs added yet</Card.Title>\n      </Card>\n    </>\n  }\n  return <>\n    <Card>\n      <Card.Text>\n        {songs.map(s => <SongQueueListItem votes={s.votes} track={s.track} onVote={onVoteHandler}/>)}\n      </Card.Text>\n    </Card>\n  </>\n}\n","import {Accordion} from \"react-bootstrap\";\nimport {BASE_URI} from \"../constants\";\n\n\nexport default function QuarrySharing(props) {\n  const { phrase } = props;\n\n  return (<Accordion defaultActiveKey=\"0\">\n    <Accordion.Item eventKey=\"0\">\n      <Accordion.Header>Bring your friends here üôã‚Äç‚ôÄÔ∏è</Accordion.Header>\n      <Accordion.Body>\n        Tell them to enter <code>\"{phrase.replace('-', ' ')}\" </code>\n        on {BASE_URI}. They can also go to <a href={`${BASE_URI}/${phrase}`}>{`${BASE_URI}/${phrase}`}</a> directly.\n      </Accordion.Body>\n    </Accordion.Item>\n  </Accordion>);\n}\n","import {Modal, Button, Badge} from \"react-bootstrap\";\nimport {FaTicketAlt} from 'react-icons/fa';\nimport {MONEY_SINGULAR} from '../constants'\nimport TrackPreview from \"./TrackPreview\";\n\nexport default function ConfirmSongSelection({show, track, handler}) {\n  if (track === null) {\n    return null;\n  }\n  return <Modal show={show}>\n    <Modal.Header>\n      <Modal.Title>Nominating Song</Modal.Title>\n    </Modal.Header>\n    <Modal.Body>Do you want to spend <b>1 {MONEY_SINGULAR}</b> to nominate this song?\n      <br/>\n      <TrackPreview track={track}/>\n    </Modal.Body>\n    <Modal.Footer>\n      <Button variant=\"outline-secondary\" onClick={() => handler(false)}>\n        Close\n      </Button>\n      <Button variant=\"dark\" onClick={() => handler(true)}>\n        Submit&nbsp; <Badge bg='primary' pill>-1 <FaTicketAlt/></Badge>\n      </Button>\n    </Modal.Footer>\n  </Modal>\n}\n","import spotify from '../externalApis/spotify';\nimport {IoFlameSharp} from 'react-icons/io5';\nimport useUser from '../auth/identity'\nimport User from '../models/User';\nimport Quarry from '../models/Quarry';\nimport {MONEY_PLURAL} from '../constants';\nimport {FormControl, InputGroup, Button, Badge, ListGroup} from \"react-bootstrap\";\nimport {useState} from \"react\";\nimport {Time} from 'goodtimer';\nimport ConfirmSongSelection from \"./ConfirmSongSelection\";\n\nexport default function SongSelector({soupId, eventHandler = () => {}} = {}) {\n\n  const [query, setQuery] = useState('');\n  const [tracks, setTracks] = useState([]);\n  const [showConfirm, setShowConfirm] = useState(false);\n  const [selectedTrack, setSelectedTrack] = useState(null);\n  const [submittingSong, setSubmittingSong] = useState(false);\n  const user = useUser();\n\n  function doSearch() {\n    spotify.request('/search', {\n      params: {\n        q: query,\n        type: 'track',\n        limit: 6\n      }\n    })\n      .then(res => {\n        console.log(res);\n        if (!res) {\n          return;\n        }\n        setTracks(res.data.tracks.items)\n      })\n  }\n\n  function handleSelected(selectedTrack) {\n    setSelectedTrack(selectedTrack);\n    setShowConfirm(true);\n  }\n\n  function handleConfirmation(isConfirmed) {\n    setShowConfirm(false);\n    if (isConfirmed && !submittingSong) {\n      setSubmittingSong(true);\n\n      User.findById(user)\n        .then(userDoc => {\n          if (userDoc.money < 1) {\n            alert(`You're too broke! Wait a few minutes for your ${MONEY_PLURAL} to be replenished.`);\n            throw Error('Silent');\n          }\n          const updatedMoney = userDoc.money - 1;\n          return User.update({_id: user}, {money: updatedMoney})\n            .then(user => {\n              eventHandler('updateUser');\n              eventHandler('selectedTrack', selectedTrack);\n              return user;\n            })\n        })\n        .then(() => Quarry.findById(soupId))\n        .then(soup => {\n          console.log('got soup ', soup);\n          const updateQueue = [{votes: 5, track: selectedTrack}, ...soup.queue];\n          return Quarry.update({_id: soup._id}, {queue: updateQueue})\n        })\n        .catch(e => {\n          if (e.message.toLowerCase() === 'silent') {\n            return e;\n          }\n          throw e;\n        })\n        .finally(() => {\n          setSubmittingSong(false);\n        })\n\n      if (user.money < 1) {\n        console.log('no money!');\n        return;\n      }\n    }\n  }\n\n  function renderTrack(track, key) {\n    const time = new Time(track.duration_ms);\n    // TODO TrackPreview.jsx should have a variant that renders this\n    return <ListGroup.Item\n      className=\"d-flex justify-content-between align-items-start\"\n      key={key}\n      action\n      onClick={() => handleSelected(track)}\n    >\n      <div>\n        <div className=\"fw-bold\">{track.name}&nbsp;\n          {track.explicit && <Badge bg='secondary'>Explicit</Badge>}&nbsp;\n          {track.popularity > 75 && <IoFlameSharp size='1.3em' style={{color: '#ff8c00'}}/>}\n          {track.popularity > 83 && <IoFlameSharp size='1.3em' style={{color: '#ff8c00'}}/>}\n          {track.popularity > 92 && <IoFlameSharp size='1.3em' style={{color: '#ff8c00'}}/>}\n        </div>\n        <div>{track.artists.map(a => a.name).join(', ')}</div>\n      </div>\n      <div style={{fontFamily: 'monospace'}}>{time.toString('s')}</div>\n    </ListGroup.Item>\n  }\n\n  return <>\n    <InputGroup>\n      <FormControl\n        placeholder=\"Type to search...\"\n        value={query}\n        onChange={(event) => setQuery(event.target.value)}\n      />\n    </InputGroup>\n    <Button onClick={doSearch}>Search</Button>\n    <br/>\n    <ListGroup>\n      {tracks.map(renderTrack)}\n    </ListGroup>\n    <ConfirmSongSelection show={showConfirm} track={selectedTrack} handler={handleConfirmation}/>\n  </>\n}\n","import {AiOutlinePlusCircle} from 'react-icons/ai';\nimport {FaMusic, FaTicketAlt} from 'react-icons/fa'\nimport {useState, useEffect} from 'react';\nimport {useParams} from 'react-router-dom';\nimport find from 'lodash.find';\nimport sortBy from 'lodash.sortby';\nimport { startMoneyLoop, stopMoneyLoop } from '../routines/moneyReplenish';\nimport Loading from \"../components/Loading\";\nimport QuarryModel from '../models/Quarry';\nimport {MobilishView} from \"../components/MobilishView\";\nimport SongQueue from \"../components/SongQueue\";\nimport {Tabs, Tab} from \"react-bootstrap\";\nimport QuarrySharing from \"../components/QuarrySharing\";\nimport SongSelector from \"../components/SongSelector\";\nimport User from \"../models/User\";\nimport useUser from \"../auth/identity\";\n\nexport default function Quarry() {\n  const {id: quarryId} = useParams();\n\n  const [quarry, setQuarry] = useState(null);\n  const [errorCode, setErrorCode] = useState(null);\n  const [updating, setUpdating] = useState(false);\n  const [user, setUser] = useState(null);\n  const myId = useUser();\n\n  useEffect(() => {\n    if (quarry !== null) {\n      return;\n    }\n\n    User.findById(myId)\n      .then((user) => setUser(user, [quarry, myId, quarryId]));\n\n    QuarryModel.findById(quarryId)\n      .then(quarry => {\n        if (!quarry) {\n          console.log('setting error');\n          return setErrorCode(404);\n        }\n        setQuarry(quarry);\n        startMoneyLoop();\n      });\n\n    return stopMoneyLoop;\n  });\n\n  const songSelectorEvent = (event, data) => {\n    if (updating) {\n      return;\n    }\n    if (event === 'updateUser') {\n      User.findById(myId)\n        .then((user) => setUser(user, [quarry, myId, quarryId]));\n    } else if (event === 'selectedTrack') {\n      console.log('adding track', data);\n    } else if (['up', 'down'].includes(event)) {\n      setUpdating(true)\n      const songToUpdate = find(quarry.queue, (o) => o.track.id === data.track.id);\n      console.log('found in queue ', songToUpdate);\n      songToUpdate.votes += event === 'up' ? 1 : -1;\n      quarry.queue = sortBy(quarry.queue, 'votes').reverse();\n      QuarryModel.update({_id: quarry._id}, {queue: quarry.queue})\n        .then(() => setQuarry(quarry))\n        .finally(() => setUpdating(false));\n    }\n  }\n\n  if (errorCode) {\n    console.log(errorCode);\n    if (errorCode === 404) {\n      return (<MobilishView>\n        <h1>Quarry not found <code>404</code></h1>\n        <p>It might have been deleted. Or we might've screwed up (probs not tbh)</p>\n        <p><a href='/'>Back to the pantry</a></p>\n      </MobilishView>);\n    }\n    return (<MobilishView>\n      <h1>Uh oh</h1>\n      <p>Don't look at me.</p>\n      <p><a href='/'>Just go away</a></p>\n    </MobilishView>)\n  }\n  if (quarry === null) {\n    return <Loading/>\n  }\n  const userMoneyStat = <><FaTicketAlt/> {user?.money}</>;\n  return <MobilishView align='left'>\n    <section>\n      <h2>{quarry.name} </h2><h4>{ typeof user?.money === 'number' ? userMoneyStat : ' '}</h4>\n    </section>\n    <QuarrySharing phrase={quarry.phrase}/>\n    <br/>\n    <Tabs defaultActiveKey=\"profile\" id=\"uncontrolled-tab-example\" className=\"mb-3\">\n      <Tab eventKey=\"songs\" title={<><FaMusic/> Songs</>}>\n        <SongQueue songs={quarry.queue} onVote={songSelectorEvent}/>\n      </Tab>\n      <Tab eventKey=\"new\" title={<><AiOutlinePlusCircle/> New </>}>\n        <SongSelector eventHandler={songSelectorEvent} soupId={quarryId}/>\n      </Tab>\n    </Tabs>\n  </MobilishView>\n}\n","import {Routes, Route } from \"react-router-dom\";\nimport './App.css';\nimport {initializeApp} from \"firebase/app\";\n\nimport SelectAQuarry from \"./views/SelectAQuarry\";\nimport NewQuarry from \"./views/NewQuarry\";\nimport ConnectSpotify from \"./views/ConnectSpotify\";\nimport QuarryFromUrl from \"./views/QuarryFromUrl\";\nimport Quarry from \"./views/Quarry\";\n\nconst style = {\n  'display': 'flex',\n  justifyContent: 'center'\n}\n\nfunction App() {\n\n    initializeApp({\n      apiKey: 'AIzaSyDQfAAJqtKOKXEdRL1SfqS3Pj8VjAIqvzE',\n      authDomain: 'music-mining.firebaseapp.com',\n      projectId: 'music-mining',\n      storageBucket: 'music-mining.appspot.com',\n      messagingSenderId: \"616247216727\",\n      appId: \"1:616247216727:web:951437741a8d7445b3f112\"\n    });\n\n\n  return (\n    <div className=\"App\" style={style}>\n      <Routes>\n        <Route path=\"/\" element={<SelectAQuarry/>}/>\n        <Route path=\"/spotifyConnect\" element={<ConnectSpotify/>}/>\n        <Route path=\"/callback\" element={<ConnectSpotify/>}/>\n        <Route path=\"/quarry/new\" element={<NewQuarry/>}/>\n        <Route path=\"/quarry/:id\" element={<Quarry/>}/>\n        <Route path=\"/:phrase\" element={<QuarryFromUrl/>}/>\n      </Routes>\n    </div>\n  );\n}\n\nexport default App;\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { BrowserRouter } from \"react-router-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport getDatabase from \"./database/getDatabase\";\nimport {connectFirestoreEmulator} from \"firebase/firestore\";\nimport {initializeApp} from \"firebase/app\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\ninitializeApp({\n  apiKey: 'AIzaSyDQfAAJqtKOKXEdRL1SfqS3Pj8VjAIqvzE',\n  authDomain: 'music-mining.firebaseapp.com',\n  projectId: 'music-mining',\n  storageBucket: 'music-mining.appspot.com',\n  messagingSenderId: \"616247216727\",\n  appId: \"1:616247216727:web:951437741a8d7445b3f112\"\n});\n\nconst db = getDatabase();\nif (process.NODE_ENV === 'production') {\n  // TODO prod connection\n} else {\n  connectFirestoreEmulator(db, 'localhost', 8080);\n  // setTasks([..tasks.slice(0, 1), true, ...tasks.slice(2)]);\n}\n\nReactDOM.render(\n    <BrowserRouter>\n        <App />\n    </BrowserRouter>,\n    document.getElementById(\"root\")\n);\n"],"sourceRoot":""}