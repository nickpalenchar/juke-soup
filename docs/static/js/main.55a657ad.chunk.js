(this["webpackJsonpmusic-mining"]=this["webpackJsonpmusic-mining"]||[]).push([[0],{100:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var r,c=n(30);function a(){return r||(r=Object(c.h)())}e.NODE_ENV}).call(this,n(21))},20:function(e,t){var n={APP_NAME:"JukeSoup",BASE_URI:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BASE_URI||"http://localhost:3000",SPOTIFY_API:"https://api.spotify.com/v1",SPOTIFY_ACCOUNTS_API:"https://accounts.spotify.com",SPOTIFY_CLIENT_ID:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_CLIENT_ID,SPOTIFY_SCOPES:["user-read-playback-state","user-modify-playback-state","user-read-currently-playing","user-read-recently-played"],MONEY_SINGULAR:"ticket",MONEY_PLURAL:"tickets",MAX_MONEY:20};n.SPOTIFY_REDIRECT_URI="".concat(n.BASE_URI,"/callback"),e.exports=n},212:function(e,t,n){"use strict";var r=n(19),c=(n(220),n(96)),a=n(10),o=n(1),i=n(6),s=n(33),u=n(3),l=n.n(u),d=n(7),j=n(4),h=n(5),p=n(30),b=n(99),f=n.n(b),O=n(100),g=function(){if(localStorage.getItem("ORMDEBUG")){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["[ORM:DEBUG]"].concat(n,[{stack:new Error}]))}};g.group=function(e){return!1},g.groupEnd=function(){return!1};var x=function(){function e(){Object(j.a)(this,e)}return Object(h.a)(e,null,[{key:"setDb",value:function(t){g("Setting db connection to",t),e._dbconnection=t}},{key:"model",value:function(t,n){if(!n)return e._models[t];var r=new y(t,n,e._dbconnection);return e._models[t]=r,r}}]),e}();x._models={},x._dbconnection=O.a;var y=function(){function e(t,n,r){Object(j.a)(this,e),this._schema=n,this._collection=t,this._getdb=r,this._hooks={preCreate:function(){}}}return Object(h.a)(e,[{key:"preCreate",value:function(e){this._hooks.preCreate=e}},{key:"validate",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=Object(a.a)(n[t],2),c=r[0],o=r[1];if("_id"!==c){if(console.log(c,this._schema[c]),!this._schema[c])throw Error("document has extra property '".concat(c,"'\n        Schema keys are ").concat(Object.keys(this._schema).join(", ")));if(Array.isArray(this._schema[c])){if(!Array.isArray(o))throw Error("Expected ".concat(c," to be an Array but was ").concat(typeof o))}else if(typeof this._schema[c]()!==typeof o)throw Error("Expected '".concat(c,"' to be type ").concat(typeof this._schema[c](),", but was ").concat(typeof o,"\n        Schema keys are ").concat(Object.keys(this._schema).join(", ")))}}return e}},{key:"create",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,r,c,a,o,i=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=i.length>1&&void 0!==i[1]?i[1]:{},r=n.fetchDoc,c=void 0===r||r,g("creating document ",t),this._hooks.preCreate(t),this.validate(t),a=this._getdb(),e.next=8,Object(p.a)(Object(p.b)(a,this._collection),t);case 8:if(o=e.sent,!c){e.next=12;break}return g("fetching document"),e.abrupt("return",this.findById(o.id,{cache:!1}));case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,c,a,o,i,u,d,j,h,b=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=b.length>1&&void 0!==b[1]?b[1]:{},c=r.document,a=void 0===c||c,g.group("find"),g("called with query",t),t._id&&(o=t._id,delete t._id),i=this._getdb(),g("using db",i),u=Object(p.b)(i,this._collection),g("using collection",u),d=p.i.apply(void 0,[u].concat(Object(s.a)(v(t)))),e.next=11,Object(p.g)(d);case 11:if(j=e.sent,null===(n=j.docs)||void 0===n?void 0:n.length){e.next=16;break}return g("find: no query found"),g.groupEnd(),e.abrupt("return",void 0);case 16:if(!o){e.next=21;break}return h=f()(j.docs,(function(e){return e.id===o})),g("found doc (by id): ",h),g.groupEnd(),e.abrupt("return",a?[m(h)]:[h]);case 21:return g("found docs (as snapshots):",j.docs),g.groupEnd(),e.abrupt("return",a?j.docs.map(m):j.docs);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findOne",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,c,a,o=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=n.document,c=void 0===r||r,g.group("findOne"),e.next=4,this.find(t,{document:c});case 4:if(a=e.sent){e.next=9;break}return g("no docs found"),g.groupEnd(),e.abrupt("return");case 9:return g("fond ".concat(a.length," docs, first one is "),a[0]),g.groupEnd(),e.abrupt("return",a[0]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findById",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,c,a,o,i,s,u,d=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:{},r=n.cache,c=void 0===r||r,a=n.document,o=void 0===a||a,g.group("findById"),g("using id ",t,{cache:c},this._collection),i=this._getdb(),s=Object(p.d)(i,"/".concat(this._collection,"/").concat(t)),e.next=7,c?Object(p.e)(s):Object(p.f)(s);case 7:if(u=e.sent,g.groupEnd(),o){e.next=12;break}return g("returning snapshot rather than document"),e.abrupt("return",o);case 12:return e.abrupt("return",m(u));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findOrCreate",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.group("findOrCreate"),g("called with queryObj =",t),e.next=4,this.findOne(t);case 4:if(n=e.sent){e.next=13;break}return t._id||delete t._id,g("doc not found, creating."),e.next=10,this.create(t);case 10:return r=e.sent,g.groupEnd(),e.abrupt("return",r);case 13:return g("Found doc:",n),g.groupEnd(),e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(d.a)(l.a.mark((function e(t,n){var r,c,o,i,s,u,d,j,h,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.group("update"),e.next=3,this.findOne(t);case 3:if(r=e.sent){e.next=8;break}return g("Could not find doc!"),g.groupEnd(),e.abrupt("return",null);case 8:c=this._getdb(),o=Object(p.d)(c,"/".concat(this._collection,"/").concat(r._id)),g.groupEnd(),i=[],s=0,u=Object.entries(n);case 13:if(!(s<u.length)){e.next=22;break}return d=Object(a.a)(u[s],2),j=d[0],h=d[1],e.next=17,Object(p.j)(o,j,h);case 17:b=e.sent,i.push(b);case 19:s++,e.next=13;break;case 22:return e.abrupt("return",i);case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function v(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var c=Object(a.a)(r[n],2),o=c[0],i=c[1];t.push(Object(p.k)(o,"==",i))}return t}function m(e){if(null===e||void 0===e?void 0:e.data())return Object(i.a)(Object(i.a)({},e.data()),{},{_id:e.id})}var k=n(20),_={money:Number,score:Number,displayName:String},S=x.model("User",_);S.preCreate((function(e){var t;e.score=e.score||0,e.money=null!==(t=e.money)&&void 0!==t?t:k.MAX_MONEY}));var w=S;function T(){var e=Object(o.useState)(null),t=Object(a.a)(e,2),n=t[0],r=t[1];return Object(o.useEffect)((function(){var e=localStorage.getItem("_id");w.findOrCreate({_id:e}).then((function(t){localStorage.setItem("_id",t._id),r(e)}))})),n}var E=n(2);function I(){var e=Object(o.useState)(""),t=Object(a.a)(e,2),n=t[0],r=t[1];return setTimeout((function(){return r(Object(E.jsx)("div",{children:"Loading"}))}),1200),Object(E.jsx)(E.Fragment,{children:n})}function A(e){var t=e.children,n={width:"520px",midWidth:"200px"};return e.align&&(n.textAlign=e.align),Object(E.jsx)("div",{className:"mobilish",style:n,children:t})}var C=function(e){var t=Object(r.t)();return null===T()?Object(E.jsx)(I,{}):Object(E.jsxs)(A,{children:[Object(E.jsx)("h1",{children:"Find a Quarry"}),Object(E.jsx)("input",{type:"text",className:"input-center",placeholder:'two words (e.g. "shining-pearl")'})," | ",Object(E.jsx)("button",{children:"Enter"}),Object(E.jsx)("br",{}),Object(E.jsx)("hr",{}),Object(E.jsxs)("h3",{children:["or ",Object(E.jsx)("button",{onClick:function(){return t("/soup/new")},children:"create one"})]})]})},P=n(349),N=n(352),R=n(207),q=n(345),D=n(102),F=["shining","cool","fun","rad","good","nice","helpful","hip","musical","kind","free","great","bad","hot","cold","warm","frozen","tall","short","quick","red","green","blue","square","smart","long","rich","calm","windy","round","solid","liquid","meta","cyber","swanky","fruity"],U=["pearl","mom","dad","daddy","boy","girl","car","trick","mine","quarry","pot","egg","seltzer","gas","power","iphone","salt","pepper","bed","table","soda","chair","rug","bean","ice","yoyo","rug","can","wheel","yoga","button","stick","fire","rain","sun","god","gold","cup","app","bread","box","toy","tea"];function L(){return[F[Math.floor(Math.random()*F.length)],U[Math.floor(Math.random()*U.length)]]}var Y={leader:String,name:String,queue:[],phrase:String,created:Object,currentTrack:Object,startedAt:Object,isPlaying:Boolean,duration:Number},B=x.model("Quarry",Y);B.preCreate((function(e){e.queue=[],e.created=new Date}));var M=B;function K(e){var t=Object(r.t)(),n=T(),c=Object(o.useState)(L()),i=Object(a.a)(c,2),s=i[0],u=i[1],l=Object(o.useState)(!1),d=Object(a.a)(l,2),j=d[0],h=d[1],p=Object(o.useState)(""),b=Object(a.a)(p,2),f=b[0],O=b[1],g=Object(o.useState)(!1),x=Object(a.a)(g,2),y=x[0],v=x[1],m=function(e){if(!1===e.currentTarget.checkValidity())return e.preventDefault(),void e.stopPropagation();h(!0),f&&(v(!0),M.create({leader:n,phrase:s.join("-"),name:f}).then((function(e){console.log("new quarry",e),t("/soup/".concat(e._id))})))};return null===n?Object(E.jsx)(I,{}):Object(E.jsxs)(A,{children:[Object(E.jsx)("h1",{children:"Open a Quarry. Discover Music."}),Object(E.jsxs)(P.a,{noValidate:!0,validated:j,onSubmit:m,action:"",children:[Object(E.jsxs)(P.a.Group,{controlId:"name",children:[Object(E.jsx)(P.a.Label,{children:"Quarry Name"}),Object(E.jsx)(P.a.Control,{required:!0,type:"input",placeholder:"(e.g. Nick's Soup)",value:f,onChange:function(e){O(e.target.value)}})]}),Object(E.jsx)("br",{}),Object(E.jsxs)(N.a,{style:{width:"480px"},children:[Object(E.jsx)(N.a.Text,{children:"Your 2-word phrase:"}),Object(E.jsx)(R.a,{style:{textAlign:"center",fontFamily:"monospace",color:"red"},readOnly:!0,value:s[0],"aria-label":"Recipient's username with two button addons"}),Object(E.jsx)(R.a,{style:{textAlign:"center",fontFamily:"monospace",color:"red"},readOnly:!0,value:s[1],"aria-label":"Recipient's username with two button addons"}),Object(E.jsx)(q.a,{variant:"outline-secondary",onClick:function(){return u(L())},children:Object(E.jsx)(D.b,{})})]}),Object(E.jsx)(P.a.Text,{className:"text-muted",children:"This is helps friends find you."}),Object(E.jsx)("br",{}),Object(E.jsxs)(q.a,{className:y?"btn-secondary":"btn-success",type:"",onClick:m,disabled:y,children:[" ",y?"working \ud83d\udca6":"Create"]})]})]})}var H=n(208),W=n.n(H),V=n(118),z=n.n(V),Q="spotifyAccessToken_DO_NOT_SHARE",J="spotifyRefreshToken",G=new(function(){function e(){Object(j.a)(this,e)}return Object(h.a)(e,[{key:"accessToken",get:function(){return localStorage.getItem(Q)},set:function(e){localStorage.setItem(Q,e)}},{key:"refreshToken",get:function(){return localStorage.getItem(J)},set:function(e){localStorage.setItem(J,e)}}]),e}()),X=new(function(){function e(){Object(j.a)(this,e),this.axios=this._createAxiosWithSpotifyAuth()}return Object(h.a)(e,[{key:"_createAxiosWithSpotifyAuth",value:function(){return z.a.create({baseURL:k.SPOTIFY_API,headers:{Authorization:"Bearer ".concat(G.accessToken)}})}},{key:"setAccessToken",value:function(e){G.accessToken=e,this.axios=this._createAxiosWithSpotifyAuth()}},{key:"setRefreshToken",value:function(e){G.refreshToken=e,this.axios=this._createAxiosWithSpotifyAuth()}},{key:"setTokensWithCode",value:function(){var e=Object(d.a)(l.a.mark((function e(t,n){var r,c,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new URLSearchParams).append("grant_type","authorization_code"),r.append("code",t),r.append("redirect_uri",k.SPOTIFY_REDIRECT_URI),r.append("client_id",k.SPOTIFY_CLIENT_ID),r.append("code_verifier",n),c="".concat(k.SPOTIFY_ACCOUNTS_API,"/api/token"),e.next=9,z()({url:c,method:"post",data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 9:return a=e.sent,this.setAccessToken(a.data.access_token),this.setRefreshToken(a.data.refresh_token),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,r=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.axios.apply(this,r);case 3:t=e.sent,e.next=13;break;case 6:if(e.prev=6,e.t0=e.catch(0),"The access token expired"!==(null===(n=e.t0.response)||void 0===n?void 0:n.data.error.message)){e.next=13;break}return console.log("access token expired, trying new token"),e.next=12,this.requestAccessTokenFromRefreshToken();case 12:return e.abrupt("return",this.request.apply(this,r));case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"requestAccessTokenFromRefreshToken",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("starting refresh flow"),t=new URLSearchParams({grant_type:"refresh_token",refresh_token:G.refreshToken,client_id:k.SPOTIFY_CLIENT_ID}),e.prev=2,e.next=5,z()({url:"".concat(k.SPOTIFY_ACCOUNTS_API,"/api/token"),method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:t});case 5:return n=e.sent,G.accessToken=n.data.access_token,G.refreshToken=n.data.refresh_token,e.abrupt("return",n);case 11:if(e.prev=11,e.t0=e.catch(2),"Request failed with status code 400"!==e.t0.message&&!/The access token expired/.test(e.t0.message)){e.next=18;break}alert("Please reconnect Spotify"),window.location.href="/spotifyConnect",e.next=21;break;case 18:throw console.error("HANDLE THIS IN spotify.js"),console.log(e.t0),e.t0;case 21:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}()}]),e}()),$="codeVerifier_DO_NOT_SHARE",Z=W()(48),ee=Z.code_verifier,te=Z.code_challenge,ne=new URLSearchParams;ne.append("client_id",k.SPOTIFY_CLIENT_ID),ne.append("response_type","code"),ne.append("scope",k.SPOTIFY_SCOPES.join(" ")),ne.append("redirect_uri",k.SPOTIFY_REDIRECT_URI),ne.append("code_challenge_method","S256"),ne.append("code_challenge",te),console.log("using challenge ",te);var re="".concat(k.SPOTIFY_ACCOUNTS_API,"/authorize?").concat(ne.toString());function ce(){var e=Object(r.r)(),t=Object(r.t)(),n=new URLSearchParams(e.search),c=n.get("code"),a=n.get("error");if(a)return"access_denied"===a?Object(E.jsx)("h1",{children:"Oh."}):Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("h1",{children:"Yikes."}),Object(E.jsx)("h6",{children:"Just walk away"})]});if(c){var o=localStorage.getItem($);return X.setTokensWithCode(c,o).then((function(e){return console.log(e),X.axios("/me/player/currently-playing")})).then((function(){return t("/soup/new")})).catch((function(e){return console.error(e.message)})),Object(E.jsx)(I,{})}return localStorage.setItem($,ee),Object(E.jsxs)(A,{align:"center",children:[Object(E.jsx)("h1",{children:"Connect Your Spotify Account"}),Object(E.jsxs)("p",{children:["Let ",k.APP_NAME," control your music player on Spotify. Connect an account you plan on playing loud and proud."]}),Object(E.jsx)("br",{}),Object(E.jsx)(q.a,{variant:"outline-dark",href:re,children:"Authorize with Spotify"}),Object(E.jsx)("br",{}),Object(E.jsx)("br",{}),Object(E.jsx)("br",{}),Object(E.jsx)("small",{children:"We don't modify any data, such as playlists or liked songs (or anything else)"})]})}var ae=n(48).useParams;function oe(){var e=ae().phrase,t=Object(r.t)();/^\w{1,10}-\w{1,10}$/.test(e)||t("/");var n=Object(o.useState)(null),c=Object(a.a)(n,2),i=c[0],s=c[1];return console.log("its ",e),M.find({phrase:e}).then((function(e){1===(null===e||void 0===e?void 0:e.length)?t("/soup/".concat(e[0]._id)):(null===e||void 0===e?void 0:e.length)>1?(console.log("todo"),s(e)):t("/")})),null===i?Object(E.jsx)(I,{}):Object(E.jsx)("div",{children:"This is a list of soups (TODO)"})}var ie=n(83),se=n(74),ue=Object(o.createContext)({track:null,isPlaying:!1,startFrom:0,updateSpotify:!0}),le=n(209),de=n.n(le),je="lastMoneyUpdate",he=18e4,pe=null;function be(){null!==pe?(clearTimeout(pe),pe=null):console.warn("stopMoneyLoop - nothing to stop")}var fe=n(351),Oe=n(346);function ge(e){var t=e.track;return t?Object(E.jsxs)("div",{className:"d-flex",children:[Object(E.jsx)("div",{style:{margin:"16px"},children:Object(E.jsx)("img",{src:t.album.images[2].url,alt:"Track album"})}),Object(E.jsxs)("div",{style:{margin:"16px"},children:[Object(E.jsxs)("div",{className:"fw-bold",children:[t.name," ",t.explicit&&Object(E.jsx)(Oe.a,{bg:"secondary",children:"Explicit"}),"\xa0"]}),Object(E.jsx)("div",{children:t.artists.map((function(e){return e.name})).join(", ")})]})]}):null}n(337);function xe(e){var t=e.votes,n=e.track,r=e.onVote;return Object(E.jsxs)("div",{className:"container",children:[Object(E.jsxs)("div",{className:"voteWindow",children:[Object(E.jsx)("div",{className:"clickable",onClick:function(){return r("up",{track:n})},children:Object(E.jsx)(ie.c,{})}),Object(E.jsx)("div",{children:Object(E.jsx)("h3",{children:t})}),Object(E.jsx)("div",{className:"clickable",onClick:function(){return r("down",{track:n})},children:Object(E.jsx)(ie.a,{})})]}),Object(E.jsx)("div",{children:Object(E.jsx)(ge,{track:n})})]})}function ye(e){var t=e.songs,n=e.onVote;if(!t)throw Error("SongQueue component must have props `songs`");var r=function(){return n.apply(void 0,arguments)};return t.length?Object(E.jsx)(E.Fragment,{children:Object(E.jsx)(fe.a,{children:Object(E.jsx)(fe.a.Text,{children:t.map((function(e){return Object(E.jsx)(xe,{votes:e.votes,track:e.track,onVote:r})}))})})}):Object(E.jsx)(E.Fragment,{children:Object(E.jsx)(fe.a,{children:Object(E.jsxs)(fe.a.Title,{children:[Object(E.jsx)(D.a,{})," No songs added yet"]})})})}var ve=n(348),me=n(354),ke=n(350);function _e(e){var t=e.phrase;return Object(E.jsx)(ke.a,{defaultActiveKey:"0",children:Object(E.jsxs)(ke.a.Item,{eventKey:"0",children:[Object(E.jsx)(ke.a.Header,{children:"Bring your friends here \ud83d\ude4b\u200d\u2640\ufe0f"}),Object(E.jsxs)(ke.a.Body,{children:["Tell them to enter ",Object(E.jsxs)("code",{children:['"',t.replace("-"," "),'" ']}),"on ",k.BASE_URI,". They can also go to ",Object(E.jsx)("a",{href:"".concat(k.BASE_URI,"/").concat(t),children:"".concat(k.BASE_URI,"/").concat(t)})," directly."]})]})})}var Se,we=n(119),Te=n(353),Ee=n(210),Ie=n(347);function Ae(e){var t=e.show,n=e.track,r=e.handler;return null===n?null:Object(E.jsxs)(Ie.a,{show:t,children:[Object(E.jsx)(Ie.a.Header,{children:Object(E.jsx)(Ie.a.Title,{children:"Nominating Song"})}),Object(E.jsxs)(Ie.a.Body,{children:["Do you want to spend ",Object(E.jsxs)("b",{children:["1 ",k.MONEY_SINGULAR]})," to nominate this song?",Object(E.jsx)("br",{}),Object(E.jsx)(ge,{track:n})]}),Object(E.jsxs)(Ie.a.Footer,{children:[Object(E.jsx)(q.a,{variant:"outline-secondary",onClick:function(){return r(!1)},children:"Close"}),Object(E.jsxs)(q.a,{variant:"dark",onClick:function(){return r(!0)},children:["Submit\xa0 ",Object(E.jsxs)(Oe.a,{bg:"primary",pill:!0,children:["-1 ",Object(E.jsx)(se.c,{})]})]})]})]})}function Ce(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.soupId,n=e.eventHandler,r=void 0===n?function(){}:n,c=Object(o.useState)(""),i=Object(a.a)(c,2),u=i[0],l=i[1],d=Object(o.useState)([]),j=Object(a.a)(d,2),h=j[0],p=j[1],b=Object(o.useState)(!1),f=Object(a.a)(b,2),O=f[0],g=f[1],x=Object(o.useState)(null),y=Object(a.a)(x,2),v=y[0],m=y[1],_=Object(o.useState)(!1),S=Object(a.a)(_,2),I=S[0],A=S[1],C=T();function P(){X.request("/search",{params:{q:u,type:"track",limit:6}}).then((function(e){console.log(e),e&&p(e.data.tracks.items)}))}function D(e){m(e),g(!0)}function F(e){g(!1),e&&!I&&(A(!0),w.findById(C).then((function(e){if(e.money<1)throw alert("You're too broke! Wait a few minutes for your ".concat(k.MONEY_PLURAL," to be replenished.")),Error("Silent");var t=e.money-1;return w.update({_id:C},{money:t}).then((function(e){return r("updateUser"),r("selectedTrack",v),e}))})).then((function(){return M.findById(t)})).then((function(e){var t=[{votes:5,track:v}].concat(Object(s.a)(e.queue));return r("updateQueue",t),M.update({_id:e._id},{queue:t})})).catch((function(e){if("silent"===e.message.toLowerCase())return e;throw e})).finally((function(){A(!1)})),C.money<1)&&console.log("no money!")}function U(e,t){var n=new Ee.Time(e.duration_ms);return Object(E.jsxs)(Te.a.Item,{className:"d-flex justify-content-between align-items-start",action:!0,onClick:function(){return D(e)},children:[Object(E.jsxs)("div",{children:[Object(E.jsxs)("div",{className:"fw-bold",children:[e.name,"\xa0",e.explicit&&Object(E.jsx)(Oe.a,{bg:"secondary",children:"Explicit"}),"\xa0",e.popularity>75&&Object(E.jsx)(we.a,{size:"1.3em",style:{color:"#ff8c00"}}),e.popularity>83&&Object(E.jsx)(we.a,{size:"1.3em",style:{color:"#ff8c00"}}),e.popularity>92&&Object(E.jsx)(we.a,{size:"1.3em",style:{color:"#ff8c00"}})]}),Object(E.jsx)("div",{children:e.artists.map((function(e){return e.name})).join(", ")})]}),Object(E.jsx)("div",{style:{fontFamily:"monospace"},children:n.toString("s")})]},t)}return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(N.a,{children:Object(E.jsx)(R.a,{placeholder:"Type to search...",value:u,onChange:function(e){return l(e.target.value)}})}),Object(E.jsx)(q.a,{onClick:P,children:"Search"}),Object(E.jsx)("br",{}),Object(E.jsx)(Te.a,{children:h.map(U)}),Object(E.jsx)(Ae,{show:O,track:v,handler:F})]})}var Pe=function(){var e=Object(d.a)(l.a.mark((function e(t,n,r){var c,a,o,i,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.request("/me/player");case 2:return o=e.sent,e.next=5,X.request("/me/player/recently-played",{params:{limit:1}});case 5:if(i=e.sent,s=null===(c=i.data.items[0])||void 0===c||null===(a=c.track)||void 0===a?void 0:a.uri,console.log("LAST PLAYED IS ",s),console.log("PLAYER STATE ",o.data),o.data.is_playing){e.next=15;break}return console.log("\ud83d\udea8 Nothing playing! Calling",t.toString()),clearInterval(Se),Se=null,t(),e.abrupt("return");case 15:console.log("STATE",o);case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ne="TRACK_END";function Re(){return(Re=Object(d.a)(l.a.mark((function e(t){var n,r,c,a,o=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=n.offsetMs,void 0===r?0:r,n.currentUri,console.group("playTrack"),e.next=4,X.request("/me/player");case 4:if(c=e.sent,console.log({playerState:c}),c.data.item.uri!==t){e.next=10;break}return console.log("song is already playing, not playing",c.data),console.groupEnd(),e.abrupt("return");case 10:return console.log("\ud83c\udf10 Making request to Spotify to play track"),e.next=13,X.request("/me/player/play",{method:"put",data:{uris:[t]}});case 13:a=e.sent,console.log("\ud83c\udfb5\ud83c\udfb5 Response from play request",a),console.groupEnd();case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var qe=function(e){var t=e.eventHandler,n=e.soupId;if(!n)return Object(E.jsx)(I,{});var r=function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",M.update({_id:n},t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(E.jsx)(ue.Consumer,{children:function(e){if(null===e)return Object(E.jsx)("div",{children:"Talking to Spotify.."});console.group("Player:onValueChange");var n=e.isPlaying,c=e.track,a=e.startFrom,o=e.updateSpotify;return console.log("new values",{isPlaying:n,track:c,startFrom:a,updateSpotify:o}),n?c?(console.log("sending to playTrack with uri ",c.uri),function(e){return Re.apply(this,arguments)}(c.uri).catch((function(e){t("ERROR_PLAY_FAILED",e)})).then((function(){var e;return e=function(){return t(Ne)},console.log("starting player check loop"),Se||(Se=setInterval((function(){return Pe(e)}),7200)),setTimeout((function(){return Pe((function(){return t(Ne)}))}),c.duration_ms-800),r({isPlaying:!0,duration:c.duration_ms,startedAt:new Date})})),console.groupEnd(),Object(E.jsx)(ge,{track:c})):(console.log("there is no track, so send TRACK_END event"),console.groupEnd(),t(Ne),Object(E.jsx)("div",{children:"Getting next song..."})):Object(E.jsx)("div",{children:"paused"})}})};n(339);function De(){var e=Object(r.w)().id,t=Object(o.useState)(null),n=Object(a.a)(t,2),c=n[0],s=n[1],u=Object(o.useState)(null),j=Object(a.a)(u,2),h=j[0],p=j[1],b=Object(o.useState)(!1),O=Object(a.a)(b,2),g=O[0],x=O[1],y=Object(o.useState)(null),v=Object(a.a)(y,2),m=v[0],_=v[1],S=Object(o.useState)(null),C=Object(a.a)(S,2),P=C[0],N=C[1],R=Object(o.useState)(!1),D=Object(a.a)(R,2),F=D[0],U=D[1],L=Object(o.useState)("songs"),Y=Object(a.a)(L,2),B=Y[0],K=Y[1],H=T();Object(o.useEffect)((function(){if(null===c)return w.findById(H).then((function(t){return _(t,[c,H,e])})),M.findById(e).then((function(e){if(!e)return console.log("setting error"),p(404);s(e),N({isPlaying:e.isPlaying,track:e.currentTrack,updateSpotify:!0}),e.queue.length||K("new"),function(){var e=function(){var t=Object(d.a)(l.a.mark((function t(){var n,r,c,a,o,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=+localStorage.getItem(je),r=Date.now(),!(n+he<r)){t.next=15;break}return c=3*Math.floor((r-n)/he),a=localStorage.getItem("_id"),t.next=7,w.findById(a);case 7:return o=t.sent,i=o.money+c<k.MAX_MONEY?o.money+c:k.MAX_MONEY,t.next=11,w.update({_id:a},{money:i});case 11:localStorage.setItem(je,Date.now()),pe=setTimeout(e,he),t.next=17;break;case 15:return pe=setTimeout(e,n+he-r),t.abrupt("return",pe);case 17:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();if(null===pe)return e();console.error("startMoneyLoop - cannot start loop when already running")}()})),be}));var W=function(t,n){if(!g)if("updateUser"===t)w.findById(H).then((function(t){return _(t,[c,H,e])}));else if("updateQueue"===t)console.log("updating main queue data",n),s(Object(i.a)(Object(i.a)({},c),{queue:n})),K("songs");else if(["up","down"].includes(t)){x(!0),f()(c.queue,(function(e){return e.track.id===n.track.id})).votes+="up"===t?1:-1,c.queue=(c.queue,de()(c.queue,"votes").reverse()),M.update({_id:c._id},{queue:c.queue}).then((function(){return s(c)})).finally((function(){return x(!1)}))}};if(h)return console.log(h),404===h?Object(E.jsxs)(A,{children:[Object(E.jsxs)("h1",{children:["Quarry not found ",Object(E.jsx)("code",{children:"404"})]}),Object(E.jsx)("p",{children:"It might have been deleted. Or we might've screwed up (probs not tbh)"}),Object(E.jsx)("p",{children:Object(E.jsx)("a",{href:"/",children:"Back to the pantry"})})]}):Object(E.jsxs)(A,{children:[Object(E.jsx)("h1",{children:"Uh oh"}),Object(E.jsx)("p",{children:"Don't look at me."}),Object(E.jsx)("p",{children:Object(E.jsx)("a",{href:"/",children:"Just go away"})})]});if(null===c)return Object(E.jsx)(I,{});var V=Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(se.c,{})," ",null===m||void 0===m?void 0:m.money]});return Object(E.jsx)(ue.Provider,{value:P,children:Object(E.jsxs)(A,{align:"left",children:[Object(E.jsxs)("section",{children:[Object(E.jsxs)("span",{className:"header",children:[Object(E.jsxs)("h2",{children:[c.name," "]}),Object(E.jsx)(q.a,{variant:"success",onClick:function(){var e=!P.isPlaying;N(Object(i.a)(Object(i.a)({},P),{},{isPlaying:e,updateSpotify:!0})),M.update({_id:c._id},{isPlaying:e}).catch(console.error)},children:Object(E.jsx)(se.b,{})})]}),Object(E.jsx)("h4",{children:"number"===typeof(null===m||void 0===m?void 0:m.money)?V:" "})]}),Object(E.jsx)(_e,{phrase:c.phrase}),Object(E.jsx)("br",{}),Object(E.jsx)(qe,{eventHandler:function(e){if(console.log("# player event #"),"TRACK_END"===e){var t;if(F)return void console.info("player locked");U(!0),console.group("onPlayerEvent:TRACK_END"),console.log("getting next track");var n=null===(t=c.queue.pop())||void 0===t?void 0:t.track;if(console.log("next track is ",n),!n)return console.info("no next track, pausing"),N(Object(i.a)(Object(i.a)({},P),{},{isPlaying:!1,updateSpotify:!0})),U(!1),void console.groupEnd();console.log("SOUP; updating with next track",n),M.update({_id:c._id},{queue:c.queue,currentTrack:n,startedAt:new Date,isPlaying:P.isPlaying}).then((function(){return s(c)})).then((function(){console.log("setting player values"),N(Object(i.a)(Object(i.a)({},P),{},{track:n,startAt:0}))})).catch((function(e){alert(e),N(Object(i.a)(Object(i.a)({},P),{},{isPlaying:!1}))})).finally((function(){console.groupEnd(),U(!1)}))}},soupId:null===c||void 0===c?void 0:c._id}),Object(E.jsxs)(ve.a,{activeKey:B,onSelect:K,className:"mb-3",children:[Object(E.jsx)(me.a,{eventKey:"songs",title:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(se.a,{})," Songs"]}),children:Object(E.jsx)(ye,{songs:c.queue,onVote:W})}),Object(E.jsx)(me.a,{eventKey:"new",title:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(ie.b,{})," New "]}),children:Object(E.jsx)(Ce,{eventHandler:W,soupId:e})})]})]})})}var Fe={display:"flex",justifyContent:"center"};t.a=function(){return Object(c.a)({apiKey:"AIzaSyDQfAAJqtKOKXEdRL1SfqS3Pj8VjAIqvzE",authDomain:"music-mining.firebaseapp.com",projectId:"music-mining",storageBucket:"music-mining.appspot.com",messagingSenderId:"616247216727",appId:"1:616247216727:web:951437741a8d7445b3f112"}),Object(E.jsx)("div",{className:"App",style:Fe,children:Object(E.jsxs)(r.f,{children:[Object(E.jsx)(r.d,{path:"/",element:Object(E.jsx)(C,{})}),Object(E.jsx)(r.d,{path:"/spotifyConnect",element:Object(E.jsx)(ce,{})}),Object(E.jsx)(r.d,{path:"/callback",element:Object(E.jsx)(ce,{})}),Object(E.jsx)(r.d,{path:"/soup/new",element:Object(E.jsx)(K,{})}),Object(E.jsx)(r.d,{path:"/soup/:id",element:Object(E.jsx)(De,{})}),Object(E.jsx)(r.d,{path:"/:phrase",element:Object(E.jsx)(oe,{})})]})})}},214:function(e,t,n){"use strict";n.r(t),function(e){n(1);var t=n(46),r=n(48),c=(n(219),n(212)),a=n(100),o=n(30),i=n(96),s=(n(342),n(2));Object(i.a)({apiKey:"AIzaSyDQfAAJqtKOKXEdRL1SfqS3Pj8VjAIqvzE",authDomain:"music-mining.firebaseapp.com",projectId:"music-mining",storageBucket:"music-mining.appspot.com",messagingSenderId:"616247216727",appId:"1:616247216727:web:951437741a8d7445b3f112"});var u=Object(a.a)();"production"===e.NODE_ENV||Object(o.c)(u,"localhost",8080),t.render(Object(s.jsx)(r.BrowserRouter,{children:Object(s.jsx)(c.a,{})}),document.getElementById("root"))}.call(this,n(21))},219:function(e,t,n){},220:function(e,t,n){},229:function(e,t){},231:function(e,t){},241:function(e,t){},243:function(e,t){},270:function(e,t){},271:function(e,t){},276:function(e,t){},278:function(e,t){},285:function(e,t){},304:function(e,t){},337:function(e,t,n){},339:function(e,t,n){}},[[214,1,2]]]);
//# sourceMappingURL=main.55a657ad.chunk.js.map