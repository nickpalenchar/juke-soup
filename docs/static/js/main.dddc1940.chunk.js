(this["webpackJsonpmusic-mining"]=this["webpackJsonpmusic-mining"]||[]).push([[0],{106:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var r,c=n(34);function a(){return r||(r=Object(c.g)())}e.NODE_ENV}).call(this,n(22))},20:function(e,t){var n={APP_NAME:"JukeSoup",BASE_URI:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CLIENT_ID:"7acd727f06d34ecfb1c6d8b76c97d36d",REACT_APP_FIREBASE_API_KEY:"AIzaSyDQfAAJqtKOKXEdRL1SfqS3Pj8VjAIqvzE",REACT_APP_FIREBASE_AUTH_DOMAIN:"music-mining.firebaseapp.com",REACT_APP_FIREBASE_PROJECT_ID:"music-mining",REACT_APP_STORAGE_BUCKET:"music-mining.appspot.com",REACT_APP_MESSAGING_SENDER_ID:"616247216727",REACT_APP_FIREBASE_APP_ID:"1:616247216727:web:13e1f76d2cc06a0ab3f112"}).REACT_APP_BASE_URI||"http://localhost:3000",SPOTIFY_API:"https://api.spotify.com/v1",SPOTIFY_ACCOUNTS_API:"https://accounts.spotify.com",SPOTIFY_CLIENT_ID:"7acd727f06d34ecfb1c6d8b76c97d36d",SPOTIFY_SCOPES:["user-read-playback-state","user-modify-playback-state","user-read-currently-playing","user-read-recently-played"],MONEY_SINGULAR:"ticket",MONEY_PLURAL:"tickets",MAX_MONEY:20};n.SPOTIFY_REDIRECT_URI="".concat(n.BASE_URI,"/callback"),e.exports=n},224:function(e,t,n){},225:function(e,t,n){},234:function(e,t){},236:function(e,t){},246:function(e,t){},248:function(e,t){},275:function(e,t){},276:function(e,t){},281:function(e,t){},283:function(e,t){},290:function(e,t){},309:function(e,t){},342:function(e,t,n){},344:function(e,t,n){},348:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n(43),a=n(50),o=(n(224),n(19)),i=(n(225),n(102)),s=n(8),u=n(5),l=n(23),d=n(3),j=n.n(d),p=n(7),h=n(4),b=n(6),f=n(34),O=n(105),g=n.n(O),x=n(106),y=function(){if(localStorage.getItem("ORMDEBUG")){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["[ORM:DEBUG]"].concat(n,[{stack:new Error}]))}};y.group=function(e){return!1},y.groupEnd=function(){return!1};var m=function(){function e(){Object(h.a)(this,e)}return Object(b.a)(e,null,[{key:"setDb",value:function(t){y("Setting db connection to",t),e._dbconnection=t}},{key:"model",value:function(t,n){if(!n)return e._models[t];var r=new v(t,n,e._dbconnection);return e._models[t]=r,r}}]),e}();m._models={},m._dbconnection=x.a;var v=function(){function e(t,n,r){Object(h.a)(this,e),this._schema=n,this._collection=t,this._getdb=r,this._hooks={preCreate:function(){}}}return Object(b.a)(e,[{key:"preCreate",value:function(e){this._hooks.preCreate=e}},{key:"validate",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=Object(s.a)(n[t],2),c=r[0],a=r[1];if("_id"!==c){if(console.log(c,this._schema[c]),!this._schema[c])throw Error("document has extra property '".concat(c,"'\n        Schema keys are ").concat(Object.keys(this._schema).join(", ")));if(Array.isArray(this._schema[c])){if(!Array.isArray(a))throw Error("Expected ".concat(c," to be an Array but was ").concat(typeof a))}else if(typeof this._schema[c]()!==typeof a)throw Error("Expected '".concat(c,"' to be type ").concat(typeof this._schema[c](),", but was ").concat(typeof a,"\n        Schema keys are ").concat(Object.keys(this._schema).join(", ")))}}return e}},{key:"create",value:function(){var e=Object(p.a)(j.a.mark((function e(){var t,n,r,c,a,o,i=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=i.length>1&&void 0!==i[1]?i[1]:{},r=n.fetchDoc,c=void 0===r||r,y("creating document ",t),this._hooks.preCreate(t),this.validate(t),a=this._getdb(),e.next=8,Object(f.a)(Object(f.b)(a,this._collection),t);case 8:if(o=e.sent,!c){e.next=12;break}return y("fetching document"),e.abrupt("return",this.findById(o.id,{cache:!1}));case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=Object(p.a)(j.a.mark((function e(t){var n,r,c,a,o,i,s,u,d,p,h=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.length>1&&void 0!==h[1]?h[1]:{},c=r.document,a=void 0===c||c,y.group("find"),y("called with query",t),t._id&&(o=t._id,delete t._id),i=this._getdb(),y("using db",i),s=Object(f.b)(i,this._collection),y("using collection",s),u=f.h.apply(void 0,[s].concat(Object(l.a)(_(t)))),e.next=11,Object(f.f)(u);case 11:if(d=e.sent,null===(n=d.docs)||void 0===n?void 0:n.length){e.next=16;break}return y("find: no query found"),y.groupEnd(),e.abrupt("return",void 0);case 16:if(!o){e.next=21;break}return p=g()(d.docs,(function(e){return e.id===o})),y("found doc (by id): ",p),y.groupEnd(),e.abrupt("return",a?[k(p)]:[p]);case 21:return y("found docs (as snapshots):",d.docs),y.groupEnd(),e.abrupt("return",a?d.docs.map(k):d.docs);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findOne",value:function(){var e=Object(p.a)(j.a.mark((function e(t){var n,r,c,a,o=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=n.document,c=void 0===r||r,y.group("findOne"),e.next=4,this.find(t,{document:c});case 4:if(a=e.sent){e.next=9;break}return y("no docs found"),y.groupEnd(),e.abrupt("return");case 9:return y("fond ".concat(a.length," docs, first one is "),a[0]),y.groupEnd(),e.abrupt("return",a[0]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findById",value:function(){var e=Object(p.a)(j.a.mark((function e(t){var n,r,c,a,o,i,s,u,l=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:{},r=n.cache,c=void 0===r||r,a=n.document,o=void 0===a||a,y.group("findById"),y("using id ",t,{cache:c},this._collection),i=this._getdb(),s=Object(f.c)(i,"/".concat(this._collection,"/").concat(t)),e.next=7,c?Object(f.d)(s):Object(f.e)(s);case 7:if(u=e.sent,y.groupEnd(),o){e.next=12;break}return y("returning snapshot rather than document"),e.abrupt("return",o);case 12:return e.abrupt("return",k(u));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findOrCreate",value:function(){var e=Object(p.a)(j.a.mark((function e(t){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.group("findOrCreate"),y("called with queryObj =",t),e.next=4,this.findOne(t);case 4:if(n=e.sent){e.next=13;break}return t._id||delete t._id,y("doc not found, creating."),e.next=10,this.create(t);case 10:return r=e.sent,y.groupEnd(),e.abrupt("return",r);case 13:return y("Found doc:",n),y.groupEnd(),e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(p.a)(j.a.mark((function e(t,n){var r,c,a,o,i,u,l,d,p,h;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.group("update"),e.next=3,this.findOne(t);case 3:if(r=e.sent){e.next=8;break}return y("Could not find doc!"),y.groupEnd(),e.abrupt("return",null);case 8:c=this._getdb(),a=Object(f.c)(c,"/".concat(this._collection,"/").concat(r._id)),y.groupEnd(),o=[],i=0,u=Object.entries(n);case 13:if(!(i<u.length)){e.next=22;break}return l=Object(s.a)(u[i],2),d=l[0],p=l[1],e.next=17,Object(f.i)(a,d,p);case 17:h=e.sent,o.push(h);case 19:i++,e.next=13;break;case 22:return e.abrupt("return",o);case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function _(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var c=Object(s.a)(r[n],2),a=c[0],o=c[1];t.push(Object(f.j)(a,"==",o))}return t}function k(e){if(null===e||void 0===e?void 0:e.data())return Object(u.a)(Object(u.a)({},e.data()),{},{_id:e.id})}var S=n(20),w={money:Number,score:Number,displayName:String},A=m.model("User",w);A.preCreate((function(e){var t;e.score=e.score||0,e.money=null!==(t=e.money)&&void 0!==t?t:S.MAX_MONEY}));var E=A;function T(){var e=Object(r.useState)(null),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(r.useEffect)((function(){var e=localStorage.getItem("_id");E.findOrCreate({_id:e}).then((function(t){localStorage.setItem("_id",t._id),c(e)}))})),n}var I=n(2);function P(){var e=Object(r.useState)(""),t=Object(s.a)(e,2),n=t[0],c=t[1];return setTimeout((function(){return c(Object(I.jsx)("div",{children:"Loading"}))}),1200),Object(I.jsx)(I.Fragment,{children:n})}function C(e){var t=e.children,n={width:"520px",midWidth:"200px"};return e.align&&(n.textAlign=e.align),Object(I.jsx)("div",{className:"mobilish",style:n,children:t})}var R=function(e){var t=Object(o.t)();return null===T()?Object(I.jsx)(P,{}):Object(I.jsxs)(C,{children:[Object(I.jsx)("h1",{children:"Find a Quarry"}),Object(I.jsx)("input",{type:"text",className:"input-center",placeholder:'two words (e.g. "shining-pearl")'})," | ",Object(I.jsx)("button",{children:"Enter"}),Object(I.jsx)("br",{}),Object(I.jsx)("hr",{}),Object(I.jsxs)("h3",{children:["or ",Object(I.jsx)("button",{onClick:function(){return t("/soup/new")},children:"create one"})]})]})},N=n(360),q=n(363),D=n(215),F=n(354),U=n(108),B=["shining","cool","fun","rad","good","nice","helpful","hip","musical","kind","free","great","bad","hot","cold","warm","frozen","tall","short","quick","red","green","blue","square","smart","long","rich","calm","windy","round","solid","liquid","meta","cyber","swanky","fruity"],L=["pearl","mom","dad","daddy","boy","girl","car","trick","mine","quarry","pot","egg","seltzer","gas","power","iphone","salt","pepper","bed","table","soda","chair","rug","bean","ice","yoyo","rug","can","wheel","yoga","button","stick","fire","rain","sun","god","gold","cup","app","bread","box","toy","tea"];function Y(){return[B[Math.floor(Math.random()*B.length)],L[Math.floor(Math.random()*L.length)]]}var M={leader:String,name:String,queue:[],phrase:String,created:Object,currentTrack:Object,startedAt:Object,isPlaying:Boolean,duration:Number},K=m.model("Quarry",M);K.preCreate((function(e){e.queue=[],e.created=new Date}));var z=K;function H(e){var t=Object(o.t)(),n=T(),c=Object(r.useState)(Y()),a=Object(s.a)(c,2),i=a[0],u=a[1],l=Object(r.useState)(!1),d=Object(s.a)(l,2),j=d[0],p=d[1],h=Object(r.useState)(""),b=Object(s.a)(h,2),f=b[0],O=b[1],g=Object(r.useState)(!1),x=Object(s.a)(g,2),y=x[0],m=x[1],v=function(e){if(!1===e.currentTarget.checkValidity())return e.preventDefault(),void e.stopPropagation();p(!0),f&&(m(!0),z.create({leader:n,phrase:i.join("-"),name:f}).then((function(e){console.log("new quarry",e),t("/soup/".concat(e._id))})))};return null===n?Object(I.jsx)(P,{}):Object(I.jsxs)(C,{children:[Object(I.jsx)("h1",{children:"Open a Quarry. Discover Music."}),Object(I.jsxs)(N.a,{noValidate:!0,validated:j,onSubmit:v,action:"",children:[Object(I.jsxs)(N.a.Group,{controlId:"name",children:[Object(I.jsx)(N.a.Label,{children:"Quarry Name"}),Object(I.jsx)(N.a.Control,{required:!0,type:"input",placeholder:"(e.g. Nick's Soup)",value:f,onChange:function(e){O(e.target.value)}})]}),Object(I.jsx)("br",{}),Object(I.jsxs)(q.a,{style:{width:"480px"},children:[Object(I.jsx)(q.a.Text,{children:"Your 2-word phrase:"}),Object(I.jsx)(D.a,{style:{textAlign:"center",fontFamily:"monospace",color:"red"},readOnly:!0,value:i[0],"aria-label":"Recipient's username with two button addons"}),Object(I.jsx)(D.a,{style:{textAlign:"center",fontFamily:"monospace",color:"red"},readOnly:!0,value:i[1],"aria-label":"Recipient's username with two button addons"}),Object(I.jsx)(F.a,{variant:"outline-secondary",onClick:function(){return u(Y())},children:Object(I.jsx)(U.b,{})})]}),Object(I.jsx)(N.a.Text,{className:"text-muted",children:"This is helps friends find you."}),Object(I.jsx)("br",{}),Object(I.jsxs)(F.a,{className:y?"btn-secondary":"btn-success",type:"",onClick:v,disabled:y,children:[" ",y?"working \ud83d\udca6":"Create"]})]})]})}var V=n(216),W=n.n(V),Q=n(127),G=n.n(Q),J="spotifyAccessToken_DO_NOT_SHARE",X="spotifyRefreshToken",$=new(function(){function e(){Object(h.a)(this,e)}return Object(b.a)(e,[{key:"accessToken",get:function(){return localStorage.getItem(J)},set:function(e){localStorage.setItem(J,e)}},{key:"refreshToken",get:function(){return localStorage.getItem(X)},set:function(e){localStorage.setItem(X,e)}}]),e}()),Z=new(function(){function e(){Object(h.a)(this,e),this.axios=this._createAxiosWithSpotifyAuth()}return Object(b.a)(e,[{key:"_createAxiosWithSpotifyAuth",value:function(){return G.a.create({baseURL:S.SPOTIFY_API,headers:{Authorization:"Bearer ".concat($.accessToken)}})}},{key:"setAccessToken",value:function(e){$.accessToken=e,this.axios=this._createAxiosWithSpotifyAuth()}},{key:"setRefreshToken",value:function(e){$.refreshToken=e,this.axios=this._createAxiosWithSpotifyAuth()}},{key:"setTokensWithCode",value:function(){var e=Object(p.a)(j.a.mark((function e(t,n){var r,c,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new URLSearchParams).append("grant_type","authorization_code"),r.append("code",t),r.append("redirect_uri",S.SPOTIFY_REDIRECT_URI),r.append("client_id",S.SPOTIFY_CLIENT_ID),r.append("code_verifier",n),c="".concat(S.SPOTIFY_ACCOUNTS_API,"/api/token"),e.next=9,G()({url:c,method:"post",data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 9:return a=e.sent,this.setAccessToken(a.data.access_token),this.setRefreshToken(a.data.refresh_token),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=Object(p.a)(j.a.mark((function e(){var t,n,r=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.axios.apply(this,r);case 3:t=e.sent,e.next=13;break;case 6:if(e.prev=6,e.t0=e.catch(0),"The access token expired"!==(null===(n=e.t0.response)||void 0===n?void 0:n.data.error.message)){e.next=13;break}return console.log("access token expired, trying new token"),e.next=12,this.requestAccessTokenFromRefreshToken();case 12:return e.abrupt("return",this.request.apply(this,r));case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"requestAccessTokenFromRefreshToken",value:function(){var e=Object(p.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("starting refresh flow"),t=new URLSearchParams({grant_type:"refresh_token",refresh_token:$.refreshToken,client_id:S.SPOTIFY_CLIENT_ID}),e.prev=2,e.next=5,G()({url:"".concat(S.SPOTIFY_ACCOUNTS_API,"/api/token"),method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:t});case 5:return n=e.sent,$.accessToken=n.data.access_token,$.refreshToken=n.data.refresh_token,e.abrupt("return",n);case 11:if(e.prev=11,e.t0=e.catch(2),"Request failed with status code 400"!==e.t0.message&&!/The access token expired/.test(e.t0.message)){e.next=18;break}alert("Please reconnect Spotify"),window.location.href="/spotifyConnect",e.next=21;break;case 18:throw console.error("HANDLE THIS IN spotify.js"),console.log(e.t0),e.t0;case 21:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}()}]),e}()),ee="codeVerifier_DO_NOT_SHARE",te=W()(48),ne=te.code_verifier,re=te.code_challenge,ce=new URLSearchParams;ce.append("client_id",S.SPOTIFY_CLIENT_ID),ce.append("response_type","code"),ce.append("scope",S.SPOTIFY_SCOPES.join(" ")),ce.append("redirect_uri",S.SPOTIFY_REDIRECT_URI),ce.append("code_challenge_method","S256"),ce.append("code_challenge",re),console.log("using challenge ",re);var ae="".concat(S.SPOTIFY_ACCOUNTS_API,"/authorize?").concat(ce.toString());function oe(){var e=Object(o.r)(),t=Object(o.t)(),n=new URLSearchParams(e.search),r=n.get("code"),c=n.get("error");if(c)return"access_denied"===c?Object(I.jsx)("h1",{children:"Oh."}):Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)("h1",{children:"Yikes."}),Object(I.jsx)("h6",{children:"Just walk away"})]});if(r){var a=localStorage.getItem(ee);return Z.setTokensWithCode(r,a).then((function(e){return console.log(e),Z.axios("/me/player/currently-playing")})).then((function(){return t("/soup/new")})).catch((function(e){return console.error(e.message)})),Object(I.jsx)(P,{})}return localStorage.setItem(ee,ne),Object(I.jsxs)(C,{align:"center",children:[Object(I.jsx)("h1",{children:"Connect Your Spotify Account"}),Object(I.jsxs)("p",{children:["Let ",S.APP_NAME," control your music player on Spotify. Connect an account you plan on playing loud and proud."]}),Object(I.jsx)("br",{}),Object(I.jsx)(F.a,{variant:"outline-dark",href:ae,children:"Authorize with Spotify"}),Object(I.jsx)("br",{}),Object(I.jsx)("br",{}),Object(I.jsx)("br",{}),Object(I.jsx)("small",{children:"We don't modify any data, such as playlists or liked songs (or anything else)"})]})}var ie=n(50).useParams;function se(){var e=ie().phrase,t=Object(o.t)();/^\w{1,10}-\w{1,10}$/.test(e)||t("/");var n=Object(r.useState)(null),c=Object(s.a)(n,2),a=c[0],i=c[1];return console.log("its ",e),z.find({phrase:e}).then((function(e){1===(null===e||void 0===e?void 0:e.length)?t("/soup/".concat(e[0]._id)):(null===e||void 0===e?void 0:e.length)>1?(console.log("todo"),i(e)):t("/")})),null===a?Object(I.jsx)(P,{}):Object(I.jsx)("div",{children:"This is a list of soups (TODO)"})}var ue=n(90),le=n(80),de=Object(r.createContext)({track:null,isPlaying:!1,startFrom:0,updateSpotify:!0}),je=n(217),pe=n.n(je),he="lastMoneyUpdate",be=18e4,fe=null;function Oe(){null!==fe?(clearTimeout(fe),fe=null):console.warn("stopMoneyLoop - nothing to stop")}var ge=n(362),xe=n(355);function ye(e){var t=e.track;return t?Object(I.jsxs)("div",{className:"d-flex",children:[Object(I.jsx)("div",{style:{margin:"16px"},children:Object(I.jsx)("img",{src:t.album.images[2].url,alt:"Track album"})}),Object(I.jsxs)("div",{style:{margin:"16px"},children:[Object(I.jsxs)("div",{className:"fw-bold",children:[t.name," ",t.explicit&&Object(I.jsx)(xe.a,{bg:"secondary",children:"Explicit"}),"\xa0"]}),Object(I.jsx)("div",{children:t.artists.map((function(e){return e.name})).join(", ")})]})]}):null}n(342);function me(e){var t=e.votes,n=e.track,r=e.onVote;return Object(I.jsxs)("div",{className:"container",children:[Object(I.jsxs)("div",{className:"voteWindow",children:[Object(I.jsx)("div",{className:"clickable",onClick:function(){return r("up",{track:n})},children:Object(I.jsx)(ue.c,{})}),Object(I.jsx)("div",{children:Object(I.jsx)("h3",{children:t})}),Object(I.jsx)("div",{className:"clickable",onClick:function(){return r("down",{track:n})},children:Object(I.jsx)(ue.a,{})})]}),Object(I.jsx)("div",{children:Object(I.jsx)(ye,{track:n})})]})}function ve(e){var t=e.songs,n=e.onVote;if(!t)throw Error("SongQueue component must have props `songs`");var r=function(){return n.apply(void 0,arguments)};return t.length?Object(I.jsx)(I.Fragment,{children:Object(I.jsx)(ge.a,{children:Object(I.jsx)(ge.a.Text,{children:t.map((function(e){return Object(I.jsx)(me,{votes:e.votes,track:e.track,onVote:r})}))})})}):Object(I.jsx)(I.Fragment,{children:Object(I.jsx)(ge.a,{children:Object(I.jsxs)(ge.a.Title,{children:[Object(I.jsx)(U.a,{})," No songs added yet"]})})})}var _e=n(357),ke=n(356),Se=n(359),we=n(365),Ae=n(361);function Ee(e){var t=e.phrase;return Object(I.jsx)(Ae.a,{defaultActiveKey:"0",children:Object(I.jsxs)(Ae.a.Item,{eventKey:"0",children:[Object(I.jsx)(Ae.a.Header,{children:"Bring your friends here \ud83d\ude4b\u200d\u2640\ufe0f"}),Object(I.jsxs)(Ae.a.Body,{children:["Tell them to enter ",Object(I.jsxs)("code",{children:['"',t.replace("-"," "),'" ']}),"on ",S.BASE_URI,". They can also go to ",Object(I.jsx)("a",{href:"".concat(S.BASE_URI,"/").concat(t),children:"".concat(S.BASE_URI,"/").concat(t)})," directly."]})]})})}var Te,Ie=n(128),Pe=n(364),Ce=n(218),Re=n(358);function Ne(e){var t=e.show,n=e.track,r=e.handler;return null===n?null:Object(I.jsxs)(Re.a,{show:t,children:[Object(I.jsx)(Re.a.Header,{children:Object(I.jsx)(Re.a.Title,{children:"Nominating Song"})}),Object(I.jsxs)(Re.a.Body,{children:["Do you want to spend ",Object(I.jsxs)("b",{children:["1 ",S.MONEY_SINGULAR]})," to nominate this song?",Object(I.jsx)("br",{}),Object(I.jsx)(ye,{track:n})]}),Object(I.jsxs)(Re.a.Footer,{children:[Object(I.jsx)(F.a,{variant:"outline-secondary",onClick:function(){return r(!1)},children:"Close"}),Object(I.jsxs)(F.a,{variant:"dark",onClick:function(){return r(!0)},children:["Submit\xa0 ",Object(I.jsxs)(xe.a,{bg:"primary",pill:!0,children:["-1 ",Object(I.jsx)(le.c,{})]})]})]})]})}function qe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.soupId,n=e.eventHandler,c=void 0===n?function(){}:n,a=Object(r.useState)(""),o=Object(s.a)(a,2),i=o[0],u=o[1],d=Object(r.useState)([]),j=Object(s.a)(d,2),p=j[0],h=j[1],b=Object(r.useState)(!1),f=Object(s.a)(b,2),O=f[0],g=f[1],x=Object(r.useState)(null),y=Object(s.a)(x,2),m=y[0],v=y[1],_=Object(r.useState)(!1),k=Object(s.a)(_,2),w=k[0],A=k[1],P=T();function C(){Z.request("/search",{params:{q:i,type:"track",limit:6}}).then((function(e){console.log(e),e&&h(e.data.tracks.items)}))}function R(e){v(e),g(!0)}function N(e){g(!1),e&&!w&&(A(!0),E.findById(P).then((function(e){if(e.money<1)throw alert("You're too broke! Wait a few minutes for your ".concat(S.MONEY_PLURAL," to be replenished.")),Error("Silent");var t=e.money-1;return E.update({_id:P},{money:t}).then((function(e){return c("updateUser"),c("selectedTrack",m),e}))})).then((function(){return z.findById(t)})).then((function(e){var t=[{votes:5,track:m}].concat(Object(l.a)(e.queue));return c("updateQueue",t),z.update({_id:e._id},{queue:t})})).catch((function(e){if("silent"===e.message.toLowerCase())return e;throw e})).finally((function(){A(!1)})),P.money<1)&&console.log("no money!")}function U(e,t){var n=new Ce.Time(e.duration_ms);return Object(I.jsxs)(Pe.a.Item,{className:"d-flex justify-content-between align-items-start",action:!0,onClick:function(){return R(e)},children:[Object(I.jsxs)("div",{children:[Object(I.jsxs)("div",{className:"fw-bold",children:[e.name,"\xa0",e.explicit&&Object(I.jsx)(xe.a,{bg:"secondary",children:"Explicit"}),"\xa0",e.popularity>75&&Object(I.jsx)(Ie.a,{size:"1.3em",style:{color:"#ff8c00"}}),e.popularity>83&&Object(I.jsx)(Ie.a,{size:"1.3em",style:{color:"#ff8c00"}}),e.popularity>92&&Object(I.jsx)(Ie.a,{size:"1.3em",style:{color:"#ff8c00"}})]}),Object(I.jsx)("div",{children:e.artists.map((function(e){return e.name})).join(", ")})]}),Object(I.jsx)("div",{style:{fontFamily:"monospace"},children:n.toString("s")})]},t)}return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(q.a,{children:Object(I.jsx)(D.a,{placeholder:"Type to search...",value:i,onChange:function(e){return u(e.target.value)}})}),Object(I.jsx)(F.a,{onClick:C,children:"Search"}),Object(I.jsx)("br",{}),Object(I.jsx)(Pe.a,{children:p.map(U)}),Object(I.jsx)(Ne,{show:O,track:m,handler:N})]})}var De=function(){var e=Object(p.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("/me/player/recently-played",{params:{limit:1}});case 2:return n=e.sent,e.abrupt("return",null===(t=n.data.items[0])||void 0===t?void 0:t.track);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Fe=function(){var e=Object(p.a)(j.a.mark((function e(t,n,r){var c,a,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("/me/player");case 2:return c=e.sent,e.next=5,De();case 5:if(a=e.sent,o=a.uri,console.log("LAST PLAYED IS ",o),console.log("PLAYER STATE ",c.data),c.data.is_playing){e.next=15;break}return console.log("\ud83d\udea8 Nothing playing! Calling",t.toString()),clearInterval(Te),Te=null,t(),e.abrupt("return");case 15:console.log("STATE",c);case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ue="TRACK_END";function Be(e){return Le.apply(this,arguments)}function Le(){return(Le=Object(p.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Z.request("/me/player/play",{method:"put",data:{uris:[t]}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ye(){return(Ye=Object(p.a)(j.a.mark((function e(t){var n,r,c,a,o=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=n.offsetMs,void 0===r?0:r,n.currentUri,console.group("playTrack"),e.next=4,Z.request("/me/player");case 4:if(c=e.sent,console.log({playerState:c}),204!==c.status){e.next=13;break}return e.next=9,De();case 9:if(e.sent.uri===t){e.next=13;break}return console.log("\u25b6\ufe0f Playing current track as its not the last track played already"),e.abrupt("return",Be(t));case 13:if(c.data.item.uri!==t){e.next=17;break}return console.log("song is playing right now, will not re-play",c.data),console.groupEnd(),e.abrupt("return");case 17:return console.log("\ud83c\udf10 Making request to Spotify to play track"),e.next=20,Be(t);case 20:a=e.sent,console.log("\ud83c\udfb5\ud83c\udfb5 Response from play request",a),console.groupEnd();case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Me=function(e){var t=e.eventHandler,n=e.soupId;if(!n)return Object(I.jsx)(P,{});var r=function(){var e=Object(p.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",z.update({_id:n},t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(I.jsx)(de.Consumer,{children:function(e){if(null===e)return Object(I.jsx)("div",{children:"Talking to Spotify.."});console.group("Player:onValueChange");var n=e.isPlaying,c=e.track,a=e.startFrom,o=e.updateSpotify;return console.log("new values",{isPlaying:n,track:c,startFrom:a,updateSpotify:o}),n?c?(console.log("sending to playTrack with uri ",c.uri),function(e){return Ye.apply(this,arguments)}(c.uri).catch((function(e){t("ERROR_PLAY_FAILED",e)})).then((function(){var e;return e=function(){return t(Ue)},console.log("starting player check loop"),Te||(Te=setInterval((function(){return Fe(e)}),7200)),setTimeout((function(){return Fe((function(){return t(Ue)}))}),c.duration_ms-800),r({isPlaying:!0,duration:c.duration_ms,startedAt:new Date})})),console.groupEnd(),Object(I.jsx)(ye,{track:c})):(console.log("there is no track, so send TRACK_END event"),console.groupEnd(),t(Ue),Object(I.jsx)("div",{children:"Getting next song..."})):Object(I.jsx)("div",{children:"paused"})}})};n(344);function Ke(){var e=Object(o.w)().id,t=Object(r.useState)(null),n=Object(s.a)(t,2),c=n[0],a=n[1],i=Object(r.useState)(null),l=Object(s.a)(i,2),d=l[0],h=l[1],b=Object(r.useState)(!1),f=Object(s.a)(b,2),O=f[0],x=f[1],y=Object(r.useState)(null),m=Object(s.a)(y,2),v=m[0],_=m[1],k=Object(r.useState)(null),w=Object(s.a)(k,2),A=w[0],R=w[1],N=Object(r.useState)(!1),q=Object(s.a)(N,2),D=q[0],U=q[1],B=Object(r.useState)("songs"),L=Object(s.a)(B,2),Y=L[0],M=L[1],K=T();Object(r.useEffect)((function(){if(null===c)return E.findById(K).then((function(t){return _(t,[c,K,e])})),z.findById(e).then((function(e){if(!e)return console.log("setting error"),h(404);a(e),R({isPlaying:e.isPlaying,track:e.currentTrack,updateSpotify:!0}),e.queue.length||M("new"),function(){var e=function(){var t=Object(p.a)(j.a.mark((function t(){var n,r,c,a,o,i;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=+localStorage.getItem(he),r=Date.now(),!(n+be<r)){t.next=15;break}return c=3*Math.floor((r-n)/be),a=localStorage.getItem("_id"),t.next=7,E.findById(a);case 7:return o=t.sent,i=o.money+c<S.MAX_MONEY?o.money+c:S.MAX_MONEY,t.next=11,E.update({_id:a},{money:i});case 11:localStorage.setItem(he,Date.now()),fe=setTimeout(e,be),t.next=17;break;case 15:return fe=setTimeout(e,n+be-r),t.abrupt("return",fe);case 17:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();if(null===fe)return e();console.error("startMoneyLoop - cannot start loop when already running")}()})),Oe}));var H=function(t,n){if(!O)if("updateUser"===t)E.findById(K).then((function(t){return _(t,[c,K,e])}));else if("updateQueue"===t)console.log("updating main queue data",n),a(Object(u.a)(Object(u.a)({},c),{queue:n})),M("songs");else if(["up","down"].includes(t)){x(!0),g()(c.queue,(function(e){return e.track.id===n.track.id})).votes+="up"===t?1:-1,c.queue=(c.queue,pe()(c.queue,"votes").reverse()),z.update({_id:c._id},{queue:c.queue}).then((function(){return a(c)})).finally((function(){return x(!1)}))}};if(d)return console.log(d),404===d?Object(I.jsxs)(C,{children:[Object(I.jsxs)("h1",{children:["Quarry not found ",Object(I.jsx)("code",{children:"404"})]}),Object(I.jsx)("p",{children:"It might have been deleted. Or we might've screwed up (probs not tbh)"}),Object(I.jsx)("p",{children:Object(I.jsx)("a",{href:"/",children:"Back to the pantry"})})]}):Object(I.jsxs)(C,{children:[Object(I.jsx)("h1",{children:"Uh oh"}),Object(I.jsx)("p",{children:"Don't look at me."}),Object(I.jsx)("p",{children:Object(I.jsx)("a",{href:"/",children:"Just go away"})})]});if(null===c)return Object(I.jsx)(P,{});var V=Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(le.c,{})," ",null===v||void 0===v?void 0:v.money]}),W=!c.queue.length&&!c.currentTrack;return Object(I.jsx)(de.Provider,{value:A,children:Object(I.jsxs)(C,{align:"left",children:[Object(I.jsxs)("section",{children:[Object(I.jsxs)("span",{className:"header",children:[Object(I.jsxs)("h2",{children:[c.name," "]}),Object(I.jsx)(_e.a,{placement:"bottom",delay:150,overlay:function(e){return Object(I.jsx)(ke.a,Object(u.a)(Object(u.a)({},e),{},{children:"Add a song first"}))},children:Object(I.jsx)(F.a,{variant:"success",disabled:W,onClick:function(){var e=!A.isPlaying;R(Object(u.a)(Object(u.a)({},A),{},{isPlaying:e,updateSpotify:!0})),z.update({_id:c._id},{isPlaying:e}).catch(console.error)},children:Object(I.jsx)(le.b,{})})})]}),Object(I.jsx)("h4",{children:"number"===typeof(null===v||void 0===v?void 0:v.money)?V:" "})]}),Object(I.jsx)(Ee,{phrase:c.phrase}),Object(I.jsx)("br",{}),Object(I.jsx)(Me,{eventHandler:function(e){if(console.log("# player event #"),"TRACK_END"===e){var t;if(D)return void console.info("player locked");U(!0),console.group("onPlayerEvent:TRACK_END"),console.log("getting next track");var n=null===(t=c.queue.pop())||void 0===t?void 0:t.track;if(console.log("next track is ",n),!n)return console.info("no next track, pausing"),R(Object(u.a)(Object(u.a)({},A),{},{isPlaying:!1,updateSpotify:!0})),U(!1),z.update({_id:c._id},{isPlaying:!1}).catch(console.error),void console.groupEnd();console.log("SOUP; updating with next track",n),z.update({_id:c._id},{queue:c.queue,currentTrack:n,startedAt:new Date,isPlaying:A.isPlaying}).then((function(){return a(c)})).then((function(){console.log("setting player values"),R(Object(u.a)(Object(u.a)({},A),{},{track:n,startAt:0}))})).catch((function(e){alert(e),R(Object(u.a)(Object(u.a)({},A),{},{isPlaying:!1}))})).finally((function(){console.groupEnd(),U(!1)}))}},soupId:null===c||void 0===c?void 0:c._id}),Object(I.jsxs)(Se.a,{activeKey:Y,onSelect:M,className:"mb-3",children:[Object(I.jsx)(we.a,{eventKey:"songs",title:Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(le.a,{})," Songs"]}),children:Object(I.jsx)(ve,{songs:c.queue,onVote:H})}),Object(I.jsx)(we.a,{eventKey:"new",title:Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(ue.b,{})," New "]}),children:Object(I.jsx)(qe,{eventHandler:H,soupId:e})})]})]})})}var ze={display:"flex",justifyContent:"center"};var He=function(){return Object(i.a)({apiKey:"AIzaSyDQfAAJqtKOKXEdRL1SfqS3Pj8VjAIqvzE",authDomain:"music-mining.firebaseapp.com",projectId:"music-mining",storageBucket:"music-mining.appspot.com",messagingSenderId:"616247216727",appId:"1:616247216727:web:13e1f76d2cc06a0ab3f112"}),Object(I.jsx)("div",{className:"App",style:ze,children:Object(I.jsxs)(o.f,{children:[Object(I.jsx)(o.d,{path:"/",element:Object(I.jsx)(R,{})}),Object(I.jsx)(o.d,{path:"/spotifyConnect",element:Object(I.jsx)(oe,{})}),Object(I.jsx)(o.d,{path:"/callback",element:Object(I.jsx)(oe,{})}),Object(I.jsx)(o.d,{path:"/soup/new",element:Object(I.jsx)(H,{})}),Object(I.jsx)(o.d,{path:"/soup/:id",element:Object(I.jsx)(Ke,{})}),Object(I.jsx)(o.d,{path:"/:phrase",element:Object(I.jsx)(se,{})})]})})},Ve=(n(347),{apiKey:"AIzaSyDQfAAJqtKOKXEdRL1SfqS3Pj8VjAIqvzE",authDomain:"music-mining.firebaseapp.com",projectId:"music-mining",storageBucket:"music-mining.appspot.com",messagingSenderId:"616247216727",appId:"1:616247216727:web:13e1f76d2cc06a0ab3f112"});console.log("Initializing Firebase app with config",Ve);var We=Object(i.a)(Ve);Object(x.a)(We);c.render(Object(I.jsx)(a.BrowserRouter,{children:Object(I.jsx)(He,{})}),document.getElementById("root"))}},[[348,1,2]]]);
//# sourceMappingURL=main.dddc1940.chunk.js.map